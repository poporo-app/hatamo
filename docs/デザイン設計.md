# HATAMOマッチングサービス デザイン設計書

**作成日**: 2025年10月2日
**バージョン**: v1.7
**対象**: Phase 1 MVP
**最終更新**: 2025年10月6日

---

## 目次

1. [プロジェクト概要](#1-プロジェクト概要)
2. [画面一覧](#2-画面一覧)
3. [ユーザーフロー](#3-ユーザーフロー)
4. [デザインシステム](#4-デザインシステム)
5. [ワイヤーフレーム](#5-ワイヤーフレーム)
6. [レスポンシブ設計](#6-レスポンシブ設計)
7. [実装ガイドライン](#7-実装ガイドライン)

---

## 1. プロジェクト概要

### 1.1 サービスコンセプト

HATAMOは、クローズドコミュニティ内でサービスを提供・依頼できるマッチングプラットフォームです。

**主な特徴**:
- 招待コード制による信頼性の高いコミュニティ
- 手数料選択制（20%/30%/40%/50% + 運営5%）
- リアルタイムメッセージング
- Stripe決済統合
- レビュー・評価システム

### 1.2 ユーザー種別

1. **利用者（CLIENT）**: サービスを依頼する側
2. **スポンサー（SPONSOR）**: サービスを提供する側
3. **管理者（ADMIN）**: プラットフォーム運営者

### 1.3 デザイン方針

- **シンプル**: 操作が直感的で分かりやすいUI
- **信頼性**: プロフェッショナルで安心感のあるデザイン
- **効率性**: 最小限のクリックで目的を達成
- **レスポンシブ**: PC・スマートフォン両対応
- **アクセシビリティ**: WCAG 2.1 AA準拠を目指す

---

## 2. 画面一覧

### 2.1 共通画面（非ログイン）

| 画面名 | パス | 説明 |
|--------|------|------|
| ランディングページ | `/` | サービス概要、新規登録・ログインへの誘導（非ログインユーザーのみアクセス可） |

**アクセス制御**:
- **非ログイン状態でアクセス可能**: ランディングページ、新規登録、ログイン
- **ログイン状態でアクセス可能**: 上記以外の全ページ
- **ログイン後の初期画面**: 利用者はダッシュボード、スポンサーはダッシュボード、管理者はダッシュボード

### 2.2 認証関連

| 画面名 | パス | 対象 | 説明 |
|--------|------|------|------|
| 利用者登録 | `/auth/register/client` | 未認証 | 招待コード入力、基本情報登録 |
| スポンサー登録 | `/auth/register/sponsor` | 未認証 | 招待コード入力、事業者情報登録 |
| ログイン | `/auth/login` | 未認証 | メール・パスワード認証 |
| 管理者ログイン | `/admin/login` | 未認証 | 管理者専用ログイン |

### 2.3 利用者向け画面（CLIENT）

| 画面名 | パス | 説明 |
|--------|------|------|
| ダッシュボード | `/client/dashboard` | 申込状況、おすすめサービス |
| サービス一覧 | `/client/services` | カテゴリ別サービス一覧、検索・フィルター |
| サービス検索 | `/client/services/search` | 高度な検索・絞り込み |
| サービス詳細 | `/client/services/:id` | サービス詳細情報、レビュー、申込ボタン |
| スポンサー詳細 | `/client/sponsors/:id` | スポンサープロフィール、提供サービス一覧 |
| メッセージ一覧 | `/client/messages` | 会話リスト |
| メッセージ詳細 | `/client/messages/:conversationId` | チャット画面 |
| 申込フォーム | `/client/bookings/new/:serviceId` | サービス申込、利用者情報入力 |
| 決済画面 | `/client/bookings/:id/payment` | Stripe決済 |
| 申込完了 | `/client/bookings/:id/complete` | 申込完了メッセージ |
| マイ申込一覧 | `/client/bookings` | 申込履歴、ステータス確認 |
| 申込詳細 | `/client/bookings/:id` | 申込詳細、メッセージ、キャンセル |
| レビュー投稿 | `/client/bookings/:id/review` | レビュー・評価投稿 |
| プロフィール | `/client/profile` | プロフィール編集 |
| 設定 | `/client/settings` | 通知設定、パスワード変更 |

**計15画面**

### 2.4 スポンサー向け画面（SPONSOR）

| 画面名 | パス | 説明 |
|--------|------|------|
| ダッシュボード | `/sponsor/dashboard` | 統計、新規申込、売上サマリー |
| マイサービス一覧 | `/sponsor/services` | 提供サービス一覧 |
| サービス登録 | `/sponsor/services/new` | 新規サービス登録 |
| サービス編集 | `/sponsor/services/:id/edit` | サービス情報編集 |
| 申込一覧 | `/sponsor/bookings` | 受信した申込一覧 |
| 申込詳細 | `/sponsor/bookings/:id` | 申込詳細、承認・拒否 |
| メッセージ一覧 | `/sponsor/messages` | 会話リスト |
| メッセージ詳細 | `/sponsor/messages/:conversationId` | チャット画面 |
| 売上確認 | `/sponsor/revenue` | 売上明細、手数料控除後金額 |
| レビュー管理 | `/sponsor/reviews` | 受け取ったレビュー一覧 |
| プロフィール | `/sponsor/profile` | プロフィール編集、事業者情報 |
| 設定 | `/sponsor/settings` | 手数料率設定、通知設定 |

**計12画面**

### 2.5 管理者向け画面（ADMIN）

| 画面名 | パス | 説明 |
|--------|------|------|
| ダッシュボード | `/admin/dashboard` | 全体統計、アクティビティ |
| 招待コード管理 | `/admin/invite-codes` | コード生成・管理 |
| メンバー管理 | `/admin/members` | 登録メンバー一覧、ステータス管理 |
| メンバー詳細 | `/admin/members/:id` | メンバー詳細、アクション |
| サービス管理 | `/admin/services` | 掲載サービス一覧、公開設定 |
| サービス詳細 | `/admin/services/:id` | サービス詳細、承認・非公開化 |
| 申込管理 | `/admin/bookings` | 全申込一覧、ステータス管理 |
| 申込詳細 | `/admin/bookings/:id` | 申込詳細、介入機能 |
| 精算管理 | `/admin/settlements` | 手数料計算、振込額算出、PDF生成 |
| メッセージ監視 | `/admin/messages` | メッセージモニタリング |
| システム設定 | `/admin/settings` | 手数料率、サービスカテゴリ設定 |

**計11画面**

**全画面合計: 38画面**

---

## 3. ユーザーフロー

### 3.1 利用者の基本フロー

#### 新規ユーザー（初回登録）

```
[招待コード入手]
    ↓
[ランディングページ閲覧] → [「新規登録」をクリック]
    ↓
[利用者登録画面]
    ↓
[招待コード入力・検証]
    ↓
[メール・パスワード入力] → [プロフィール設定]
    ↓
[登録完了・自動ログイン] ← ここでセッション開始
    ↓
[ダッシュボードへリダイレクト]
    ↓
[サービス一覧閲覧] → [カテゴリ・検索でフィルター]
    ↓
[サービス詳細確認] → [スポンサー情報・レビュー確認]
    ↓
[メッセージで相談] ← → [スポンサーが返信]
    ↓
[サービス申込] → [利用者情報入力] → [規約同意]
    ↓
[スポンサーが承認]
    ↓
[決済処理] → [Stripe決済]
    ↓
[申込完了]
    ↓
[サービス実施] ← → [メッセージで連絡]
    ↓
[サービス完了]
    ↓
[レビュー・評価投稿]
```

#### 既存ユーザー（再ログイン）

```
[ランディングページ閲覧] → [「ログイン」をクリック]
    ↓
[ログイン画面]
    ↓
[メール・パスワード入力]
    ↓
[認証成功・セッション開始]
    ↓
[ダッシュボードへリダイレクト]
    ↓
[サービス一覧閲覧] 以降は新規ユーザーと同じフロー
```

### 3.2 スポンサーの基本フロー

#### 新規スポンサー（初回登録）

```
[招待コード入手]
    ↓
[ランディングページ閲覧] → [「新規登録」をクリック]
    ↓
[スポンサー登録画面]
    ↓
[招待コード入力・検証]
    ↓
[メール・パスワード入力] → [事業者情報設定]
    ↓
[登録完了・自動ログイン] ← ここでセッション開始
    ↓
[ダッシュボードへリダイレクト]
    ↓
[サービス登録] → [タイトル、説明、カテゴリ、価格、手数料率設定]
    ↓
[サービス公開]
    ↓
[申込受信通知]
    ↓
[申込詳細確認] → [利用者情報確認]
    ↓
[メッセージで相談対応] ← → [利用者とやり取り]
    ↓
[申込承認/拒否]
    ↓
[利用者が決済完了]
    ↓
[サービス提供] ← → [メッセージで連絡]
    ↓
[サービス完了マーク]
    ↓
[レビュー確認] → [売上確認]
```

#### 既存スポンサー（再ログイン）

```
[ランディングページ閲覧] → [「ログイン」をクリック]
    ↓
[ログイン画面]
    ↓
[メール・パスワード入力]
    ↓
[認証成功・セッション開始]
    ↓
[ダッシュボードへリダイレクト]
    ↓
[申込確認・サービス管理] 以降は新規スポンサーと同じフロー
```

### 3.3 管理者の基本フロー

```
[管理者ログイン]
    ↓
[ダッシュボード] → [全体統計確認]
    ↓
[招待コード生成] → [利用者用/スポンサー用コード発行]
    ↓
[メンバー管理] → [新規登録承認、ステータス変更]
    ↓
[サービス管理] → [サービス承認、非公開化]
    ↓
[申込管理] → [トラブル対応、ステータス変更]
    ↓
[メッセージ監視] → [不適切なやり取りチェック]
    ↓
[精算管理] → [手数料計算、振込額確定、PDF生成]
```

---

## 4. デザインシステム

### 4.1 カラーパレット

#### プライマリカラー（ブランドカラー）

```
Primary (Blue)
- 50:  #eff6ff (bg-primary-50)
- 100: #dbeafe (bg-primary-100)
- 200: #bfdbfe
- 300: #93c5fd
- 400: #60a5fa
- 500: #3b82f6 (Primary) - ボタン、リンク
- 600: #2563eb (Primary Dark) - ホバー
- 700: #1d4ed8
- 800: #1e40af
- 900: #1e3a8a
```

#### セカンダリカラー（アクセント）

```
Orange
- 50:  #fff7ed
- 100: #ffedd5
- 200: #fed7aa
- 300: #fdba74
- 400: #fb923c
- 500: #f97316 (Secondary) - アクション、強調
- 600: #ea580c (Secondary Dark)
- 700: #c2410c
- 800: #9a3412
- 900: #7c2d12
```

#### ニュートラルカラー

```
Gray (Slate)
- 50:  #f8fafc (背景)
- 100: #f1f5f9
- 200: #e2e8f0 (ボーダー)
- 300: #cbd5e1
- 400: #94a3b8 (プレースホルダー)
- 500: #64748b (セカンダリテキスト)
- 600: #475569
- 700: #334155 (ボディテキスト)
- 800: #1e293b
- 900: #0f172a (見出し)
```

#### セマンティックカラー

```
Success (Green)
- bg: #dcfce7 (green-100)
- text: #166534 (green-800)
- border: #86efac (green-300)

Warning (Yellow)
- bg: #fef3c7 (yellow-100)
- text: #92400e (yellow-900)
- border: #fde047 (yellow-300)

Error (Red)
- bg: #fee2e2 (red-100)
- text: #991b1b (red-800)
- border: #fca5a5 (red-300)

Info (Blue)
- bg: #dbeafe (blue-100)
- text: #1e40af (blue-800)
- border: #93c5fd (blue-300)
```

### 4.2 タイポグラフィ

#### フォントファミリー

```css
/* 日本語対応 */
font-family: 'Inter', 'Noto Sans JP', -apple-system, BlinkMacSystemFont,
             'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
```

#### フォントサイズスケール（Tailwind CSS）

```
xs:   0.75rem (12px)  - キャプション、ラベル
sm:   0.875rem (14px) - 補助テキスト
base: 1rem (16px)     - ボディテキスト（デフォルト）
lg:   1.125rem (18px) - サブ見出し
xl:   1.25rem (20px)  - 小見出し
2xl:  1.5rem (24px)   - 中見出し
3xl:  1.875rem (30px) - 大見出し
4xl:  2.25rem (36px)  - ページタイトル
5xl:  3rem (48px)     - ヒーロータイトル
```

#### フォントウェイト

```
Light:   300 - 軽い強調
Regular: 400 - ボディテキスト
Medium:  500 - ラベル、ボタン
Semibold: 600 - 小見出し
Bold:    700 - 見出し
Extrabold: 800 - 強調見出し
```

#### 行間（Line Height）

```
tight:   1.25  - 見出し
normal:  1.5   - ボディテキスト
relaxed: 1.75  - 読みやすさ重視
```

### 4.3 スペーシング（Tailwind CSS）

```
0:  0px
1:  0.25rem (4px)
2:  0.5rem (8px)
3:  0.75rem (12px)
4:  1rem (16px)     - 基本単位
5:  1.25rem (20px)
6:  1.5rem (24px)
8:  2rem (32px)     - セクション間
10: 2.5rem (40px)
12: 3rem (48px)
16: 4rem (64px)
20: 5rem (80px)
24: 6rem (96px)
```

### 4.4 ボーダー・角丸

```
Border Width:
- default: 1px
- 2: 2px
- 4: 4px

Border Radius:
- none: 0
- sm:   0.125rem (2px)
- default: 0.25rem (4px)  - ボタン、カード
- md:   0.375rem (6px)
- lg:   0.5rem (8px)      - モーダル
- xl:   0.75rem (12px)
- 2xl:  1rem (16px)
- full: 9999px            - 円形アバター
```

### 4.5 シャドウ

```
sm:   0 1px 2px 0 rgb(0 0 0 / 0.05)          - カード（静止）
default: 0 1px 3px 0 rgb(0 0 0 / 0.1)       - ボタン
md:   0 4px 6px -1px rgb(0 0 0 / 0.1)       - カード（ホバー）
lg:   0 10px 15px -3px rgb(0 0 0 / 0.1)     - ドロップダウン
xl:   0 20px 25px -5px rgb(0 0 0 / 0.1)     - モーダル
2xl:  0 25px 50px -12px rgb(0 0 0 / 0.25)   - 強調モーダル
```

### 4.6 コンポーネント（shadcn/ui）

プロジェクトで使用する主要コンポーネント:

**基本コンポーネント**:
- `Button` - プライマリ、セカンダリ、アウトライン、ゴースト
- `Input` - テキスト入力、メール、パスワード
- `Textarea` - 長文入力
- `Label` - フォームラベル
- `Select` - ドロップダウン選択
- `Checkbox` - チェックボックス
- `Radio Group` - ラジオボタン

**レイアウトコンポーネント**:
- `Card` - コンテンツカード
- `Separator` - セパレーター
- `Tabs` - タブナビゲーション
- `Dialog` - モーダルダイアログ
- `Sheet` - サイドシート（モバイルメニュー）

**データ表示**:
- `Table` - データテーブル
- `Badge` - ステータスバッジ
- `Avatar` - ユーザーアバター
- `Progress` - プログレスバー

**フィードバック**:
- `Alert` - アラート通知
- `Toast` - トースト通知
- `Skeleton` - ローディングスケルトン

**ナビゲーション**:
- `Dropdown Menu` - ドロップダウンメニュー
- `Breadcrumb` - パンくずリスト
- `Pagination` - ページネーション

---

## 5. ワイヤーフレーム

### 5.1 利用者向けトップページ（サービス一覧）

```
┌─────────────────────────────────────────────────────────────┐
│ HATAMO Logo              Search Box               [Profile] │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌───────────────┐   ┌─────────────────────────────────────┐│
│  │ Categories    │   │  サービス一覧                        ││
│  │               │   │                                     ││
│  │ □ IT開発      │   │  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ││
│  │ □ コンサル    │   │  │     │ │     │ │     │ │     │ ││
│  │ □ マーケ      │   │  │[IMG]│ │[IMG]│ │[IMG]│ │[IMG]│ ││
│  │ □ くらし      │   │  │     │ │     │ │     │ │     │ ││
│  │ □ 投資        │   │  ├─────┤ ├─────┤ ├─────┤ ├─────┤ ││
│  │               │   │  │Title│ │Title│ │Title│ │Title│ ││
│  ├───────────────┤   │  │¥XXX │ │¥XXX │ │¥XXX │ │¥XXX │ ││
│  │ Price Range   │   │  │★4.5 │ │★4.8 │ │★4.2 │ │★4.9 │ ││
│  │               │   │  └─────┘ └─────┘ └─────┘ └─────┘ ││
│  │ ¥10,000 - ∞   │   │                                     ││
│  │ [====|====]   │   │  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ││
│  │               │   │  │     │ │     │ │     │ │     │ ││
│  ├───────────────┤   │  │[IMG]│ │[IMG]│ │[IMG]│ │[IMG]│ ││
│  │ Sort By       │   │  │     │ │     │ │     │ │     │ ││
│  │               │   │  ├─────┤ ├─────┤ ├─────┤ ├─────┤ ││
│  │ [Popular   ▼] │   │  │Title│ │Title│ │Title│ │Title│ ││
│  │               │   │  │¥XXX │ │¥XXX │ │¥XXX │ │¥XXX │ ││
│  │ [Apply Filter]│   │  │★4.6 │ │★4.3 │ │★4.7 │ │★4.1 │ ││
│  └───────────────┘   │  └─────┘ └─────┘ └─────┘ └─────┘ ││
│                       │                                     ││
│                       │  [< Prev] [1] [2] [3] ... [Next >] ││
│                       └─────────────────────────────────────┘│
│                                                               │
├─────────────────────────────────────────────────────────────┤
│ Footer: About | Terms | Privacy | Contact                    │
└─────────────────────────────────────────────────────────────┘
```

**要素説明**:
- ヘッダー: ロゴ、検索バー、プロフィールメニュー
- サイドバー: カテゴリフィルター、価格帯スライダー、並び替え
- メインエリア: サービスカードをグリッド表示（4列）
- サービスカード: 画像、タイトル、価格、評価
- ページネーション

### 5.2 利用者ダッシュボード

```
┌─────────────────────────────────────────────────────────────┐
│ HATAMO Logo              Search Box               [Profile] │
├─────────────────────────────────────────────────────────────┤
│ [ダッシュボード] [サービス] [申込] [メッセージ] [プロフィール]│
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ダッシュボード                                               │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━      │
│                                                               │
│  ┌───────────┬───────────┬───────────┬───────────┐          │
│  │進行中     │完了       │メッセージ │お気に入り │          │
│  │3件        │12件       │5件未読    │8件        │          │
│  │[詳細]     │[詳細]     │[詳細]     │[詳細]     │          │
│  └───────────┴───────────┴───────────┴───────────┘          │
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ 最近の申込                                 [すべて見る] ││
│  ├─────────────────────────────────────────────────────────┤│
│  │ Service         Sponsor     Status       Date      Action││
│  │─────────────────────────────────────────────────────────││
│  │ Webサイト制作   田中太郎    IN_PROGRESS  2024/10/01 [詳細]││
│  │ SEOコンサル     佐藤花子    PAID         2024/09/28 [詳細]││
│  │ ロゴデザイン     山田一郎    PENDING      2024/09/25 [詳細]││
│  └─────────────────────────────────────────────────────────┘│
│                                                               │
│  ┌────────────────────┬────────────────────────────────────┐│
│  │ おすすめサービス   │  最近見たサービス                  ││
│  ├────────────────────┼────────────────────────────────────┤│
│  │ ┌─────┐ ┌─────┐   │  ┌─────┐ ┌─────┐ ┌─────┐        ││
│  │ │[IMG]│ │[IMG]│   │  │[IMG]│ │[IMG]│ │[IMG]│        ││
│  │ ├─────┤ ├─────┤   │  ├─────┤ ├─────┤ ├─────┤        ││
│  │ │Title│ │Title│   │  │Title│ │Title│ │Title│        ││
│  │ │¥XXX │ │¥XXX │   │  │¥XXX │ │¥XXX │ │¥XXX │        ││
│  │ │★4.5 │ │★4.8 │   │  │★4.2 │ │★4.9 │ │★4.6 │        ││
│  │ └─────┘ └─────┘   │  └─────┘ └─────┘ └─────┘        ││
│  │                    │                                    ││
│  │ [もっと見る]       │  [もっと見る]                      ││
│  └────────────────────┴────────────────────────────────────┘│
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ アクティビティ                                          ││
│  ├─────────────────────────────────────────────────────────┤│
│  │ • 田中太郎さんがメッセージを送信しました 5分前          ││
│  │ • 「Webサイト制作」の申込がスポンサーに承認されました 1時間前││
│  │ • 佐藤花子さんとのチャットが開始されました 2時間前      ││
│  │ • 「SEOコンサル」の決済が完了しました 昨日              ││
│  └─────────────────────────────────────────────────────────┘│
│                                                               │
├─────────────────────────────────────────────────────────────┤
│ Footer: About | Terms | Privacy | Contact                    │
└─────────────────────────────────────────────────────────────┘
```

**要素説明**:
- トップナビゲーション: メニュー（ダッシュボード、サービス、申込、メッセージ、プロフィール）
- サマリーカード: 進行中の申込、完了した申込、メッセージ未読、お気に入り
- 最近の申込テーブル: サービス名、スポンサー、ステータス、日付、アクション
- おすすめサービス: AIまたはルールベースでの推薦
- 最近見たサービス: 閲覧履歴
- アクティビティフィード: 最新のイベント・通知

### 5.3 サービス詳細ページ

```
┌─────────────────────────────────────────────────────────────┐
│ HATAMO Logo              Search Box               [Profile] │
├─────────────────────────────────────────────────────────────┤
│ Home > IT開発 > Webサイト制作                                │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌────────────────────────┬────────────────────────────────┐│
│  │                        │                                ││
│  │  ┌──────────────────┐  │  サービスタイトル              ││
│  │  │                  │  │  ━━━━━━━━━━━━━━━━━━━━━━━━    ││
│  │  │  Hero Image      │  │  ★★★★★ 4.8 (24件のレビュー)  ││
│  │  │                  │  │                                ││
│  │  │   [Service IMG]  │  │  ¥50,000〜                     ││
│  │  │                  │  │                                ││
│  │  └──────────────────┘  │  カテゴリ: IT開発              ││
│  │                        │  手数料率: 30% (+運営5%)       ││
│  │  [IMG] [IMG] [IMG]     │                                ││
│  │                        │  ┌──────────────────────────┐  ││
│  │                        │  │ スポンサー情報            │  ││
│  │                        │  │ [Avatar] 田中太郎         │  ││
│  │                        │  │ ★★★★☆ 4.5              │  ││
│  │                        │  │ 実績: 50件                │  ││
│  │                        │  │ [プロフィールを見る]      │  ││
│  │                        │  └──────────────────────────┘  ││
│  │                        │                                ││
│  │                        │  [メッセージを送る] [申し込む] ││
│  └────────────────────────┴────────────────────────────────┘│
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ [説明] [料金] [よくある質問] [レビュー(24)]            ││
│  ├─────────────────────────────────────────────────────────┤│
│  │                                                         ││
│  │  サービス詳細説明                                       ││
│  │  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━      ││
│  │                                                         ││
│  │  このサービスでは...（詳細な説明文）                    ││
│  │                                                         ││
│  │  ■ サービス内容                                        ││
│  │  ・項目1                                                ││
│  │  ・項目2                                                ││
│  │  ・項目3                                                ││
│  │                                                         ││
│  │  ■ 納期                                                ││
│  │  2週間〜1ヶ月                                           ││
│  │                                                         ││
│  │  ■ 提供方法                                            ││
│  │  オンラインミーティング + チャット                      ││
│  │                                                         ││
│  └─────────────────────────────────────────────────────────┘│
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ レビュー・評価                                          ││
│  ├─────────────────────────────────────────────────────────┤│
│  │                                                         ││
│  │  ★★★★★ 5.0  [Avatar] 佐藤花子                        ││
│  │  とても丁寧な対応で、期待以上の成果物でした...          ││
│  │  2024/09/15                                             ││
│  │  ─────────────────────────────────────────────────────  ││
│  │  ★★★★☆ 4.0  [Avatar] 山田一郎                        ││
│  │  納期通りに納品していただき、満足しています...          ││
│  │  2024/09/10                                             ││
│  │  ─────────────────────────────────────────────────────  ││
│  │  [もっと見る]                                           ││
│  └─────────────────────────────────────────────────────────┘│
│                                                               │
├─────────────────────────────────────────────────────────────┤
│ Footer: About | Terms | Privacy | Contact                    │
└─────────────────────────────────────────────────────────────┘
```

**要素説明**:
- パンくずリスト
- ヒーロー画像エリア（サムネイル付き）
- サービス情報カード（タイトル、評価、価格、カテゴリ、手数料）
- スポンサー情報カード
- CTA（メッセージ、申込ボタン）
- タブ切り替え（説明、料金、FAQ、レビュー）
- レビュー一覧

### 5.4 メッセージ画面（2ペインレイアウト）

```
┌─────────────────────────────────────────────────────────────┐
│ HATAMO Logo              Search Box               [Profile] │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌─────────────────────┬─────────────────────────────────┐  │
│  │ Messages            │ 田中太郎とのチャット             │  │
│  ├─────────────────────┼─────────────────────────────────┤  │
│  │                     │                                 │  │
│  │ ┌─────────────────┐ │  ┌─────────────────────────┐   │  │
│  │ │[Avatar] 田中太郎 │ │  │田中太郎:                │   │  │
│  │ │Webサイト制作に...│ │  │こんにちは！...          │   │  │
│  │ │5分前          [1]│ │  │                    14:30│   │  │
│  │ └─────────────────┘ │  └─────────────────────────┘   │  │
│  │                     │                                 │  │
│  │ ┌─────────────────┐ │       ┌─────────────────────┐  │  │
│  │ │[Avatar] 佐藤花子 │ │       │あなた:              │  │  │
│  │ │ありがとうござい...│ │       │ご連絡ありがとう...  │  │  │
│  │ │1時間前            │ │       │               14:35│  │  │
│  │ └─────────────────┘ │       └─────────────────────┘  │  │
│  │                     │                                 │  │
│  │ ┌─────────────────┐ │  ┌─────────────────────────┐   │  │
│  │ │[Avatar] 山田一郎 │ │  │田中太郎:                │   │  │
│  │ │了解しました。...  │ │  │はい、可能です...        │   │  │
│  │ │昨日               │ │  │                    14:40│   │  │
│  │ └─────────────────┘ │  └─────────────────────────┘   │  │
│  │                     │                                 │  │
│  │ ┌─────────────────┐ │       ┌─────────────────────┐  │  │
│  │ │[Avatar] 鈴木次郎 │ │       │あなた:              │  │  │
│  │ │見積もりについて...│ │       │わかりました...      │  │  │
│  │ │2日前              │ │       │               14:45│  │  │
│  │ └─────────────────┘ │       └─────────────────────┘  │  │
│  │                     │                                 │  │
│  │                     │  ┌─────────────────────────┐   │  │
│  │                     │  │田中太郎:                │   │  │
│  │                     │  │それでは進めましょう...  │   │  │
│  │                     │  │                    14:50│   │  │
│  │                     │  └─────────────────────────┘   │  │
│  │                     │                                 │  │
│  │                     │                                 │  │
│  │                     │ ┌───────────────────────────┐ │  │
│  │                     │ │[Type your message...      │ │  │
│  │                     │ │                    [Send] │ │  │
│  │                     │ └───────────────────────────┘ │  │
│  └─────────────────────┴─────────────────────────────────┘  │
│                                                               │
├─────────────────────────────────────────────────────────────┤
│ Footer: About | Terms | Privacy | Contact                    │
└─────────────────────────────────────────────────────────────┘
```

**要素説明**:
- 左ペイン: 会話リスト（アバター、名前、最新メッセージ、未読バッジ）
- 右ペイン: チャットエリア（吹き出し形式、タイムスタンプ）
- 入力エリア: テキストボックス、送信ボタン

### 5.5 スポンサーダッシュボード

```
┌─────────────────────────────────────────────────────────────┐
│ HATAMO Logo              [Messages] [Notifications] [田中]  │
├─────────────────────────────────────────────────────────────┤
│ [Dashboard] [Services] [Bookings] [Messages] [Revenue]       │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ダッシュボード                                               │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━      │
│                                                               │
│  ┌───────────┬───────────┬───────────┬───────────┐          │
│  │今月の売上  │新規申込   │進行中     │完了       │          │
│  │¥350,000   │5件        │3件        │12件       │          │
│  │+12%↑      │+2件       │          │          │          │
│  └───────────┴───────────┴───────────┴───────────┘          │
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ 新規申込（要対応）                         [すべて見る] ││
│  ├─────────────────────────────────────────────────────────┤│
│  │ Service         Client      Status       Amount   Action││
│  │─────────────────────────────────────────────────────────││
│  │ Webサイト制作   佐藤花子    PENDING      ¥50,000  [確認]││
│  │ SEOコンサル     山田一郎    PENDING      ¥30,000  [確認]││
│  │ ロゴデザイン     鈴木次郎    PENDING      ¥20,000  [確認]││
│  └─────────────────────────────────────────────────────────┘│
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ 進行中のサービス                           [すべて見る] ││
│  ├─────────────────────────────────────────────────────────┤│
│  │ Service         Client      Status       Progress  Action││
│  │─────────────────────────────────────────────────────────││
│  │ LP制作          田中太郎    IN_PROGRESS  [====  ] [詳細]││
│  │ 広告運用        伊藤美咲    IN_PROGRESS  [======] [詳細]││
│  │ 動画編集        高橋健一    IN_PROGRESS  [==    ] [詳細]││
│  └─────────────────────────────────────────────────────────┘│
│                                                               │
│  ┌────────────────────┬────────────────────────────────────┐│
│  │ 売上推移           │  サービス別売上                    ││
│  │ [グラフ]           │  ┌──────────────────────────────┐ ││
│  │                    │  │ Webサイト制作: ¥200,000 (57%) │ ││
│  │                    │  │ SEOコンサル:    ¥100,000 (29%) │ ││
│  │                    │  │ ロゴデザイン:    ¥50,000 (14%) │ ││
│  │                    │  └──────────────────────────────┘ ││
│  └────────────────────┴────────────────────────────────────┘│
│                                                               │
├─────────────────────────────────────────────────────────────┤
│ Footer: About | Terms | Privacy | Contact                    │
└─────────────────────────────────────────────────────────────┘
```

**要素説明**:
- トップナビゲーション: メニュー（ダッシュボード、サービス、申込、メッセージ、売上）
- 統計カード: 今月の売上、新規申込、進行中、完了（前月比表示）
- 新規申込テーブル: サービス名、クライアント、ステータス、金額、アクション
- 進行中のサービステーブル: プログレスバー表示
- グラフエリア: 売上推移グラフ、サービス別売上円グラフ

### 5.6 管理者ダッシュボード

```
┌─────────────────────────────────────────────────────────────┐
│ HATAMO Admin                                    [管理者名]   │
├─────────────────────────────────────────────────────────────┤
│ [Dashboard] [Codes] [Members] [Services] [Bookings] [...]    │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  管理者ダッシュボード                                         │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━      │
│                                                               │
│  ┌─────────┬─────────┬─────────┬─────────┬─────────┐        │
│  │総会員数  │利用者   │スポンサー│総申込   │総売上   │        │
│  │48名      │32名     │16名      │156件    │¥5.2M    │        │
│  │+3↑       │+2↑      │+1↑       │+12↑     │+8%↑     │        │
│  └─────────┴─────────┴─────────┴─────────┴─────────┘        │
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ 最近のアクティビティ                       [すべて見る] ││
│  ├─────────────────────────────────────────────────────────┤│
│  │ • 佐藤花子さんが新規登録しました（利用者） 5分前        ││
│  │ • 田中太郎さんが「Webサイト制作」を登録 15分前          ││
│  │ • 新規申込: 山田一郎 → 鈴木次郎（SEOコンサル） 1時間前 ││
│  │ • 伊藤美咲さんが招待コードを使用 2時間前               ││
│  │ • 高橋健一さんが売上¥50,000を確定 3時間前              ││
│  └─────────────────────────────────────────────────────────┘│
│                                                               │
│  ┌────────────────────┬────────────────────────────────────┐│
│  │ 要対応事項         │  システムアラート                  ││
│  ├────────────────────┼────────────────────────────────────┤│
│  │ ⚠ 未承認サービス   │  ⚠ 不適切メッセージ検出: 1件       ││
│  │   3件              │  ⚠ 返金リクエスト: 1件             ││
│  │                    │  ✓ システム正常稼働                ││
│  │ ⚠ 問題報告         │  ✓ DB接続正常                      ││
│  │   1件              │  ✓ 決済API正常                     ││
│  │                    │                                    ││
│  │ ⚠ 精算待ち         │                                    ││
│  │   5件              │                                    ││
│  └────────────────────┴────────────────────────────────────┘│
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ クイックアクション                                      ││
│  ├─────────────────────────────────────────────────────────┤│
│  │ [招待コード生成] [メンバー管理] [サービス承認]          ││
│  │ [申込管理] [精算処理] [レポート生成]                    ││
│  └─────────────────────────────────────────────────────────┘│
│                                                               │
├─────────────────────────────────────────────────────────────┤
│ Footer: System Info | Version 1.0 | © 2025 HATAMO            │
└─────────────────────────────────────────────────────────────┘
```

**要素説明**:
- 統計カード: 総会員数、利用者、スポンサー、総申込、総売上（増減表示）
- アクティビティフィード: 最近のシステムイベント
- 要対応事項: 未承認サービス、問題報告、精算待ち（件数バッジ）
- システムアラート: 異常検出、ステータス表示
- クイックアクション: 主要機能への即時アクセス

### 5.7 スポンサー向けサービス一覧（マイサービス）

```
┌─────────────────────────────────────────────────────────────┐
│ HATAMO Logo              [Messages] [Notifications] [田中]  │
├─────────────────────────────────────────────────────────────┤
│ [Dashboard] [Services] [Bookings] [Messages] [Revenue]       │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  マイサービス                                                 │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━      │
│                                                               │
│  ┌────────────┬────────────┬────────────┬────────────┐       │
│  │総サービス数│公開中      │非公開      │総申込数    │       │
│  │8件         │6件         │2件         │42件        │       │
│  │            │            │            │            │       │
│  └────────────┴────────────┴────────────┴────────────┘       │
│                                                               │
│  ┌──────────────────────────────┐  [+ 新規サービス作成]      │
│  │ 🔍 [サービス名で検索...]     │                            │
│  └──────────────────────────────┘                            │
│                                                               │
│  ┌────────────┬──────────────┬──────────────┐               │
│  │[すべて ▼]  │[カテゴリ ▼] │[並び替え ▼] │               │
│  │            │              │              │               │
│  └────────────┴──────────────┴──────────────┘               │
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ サービス一覧テーブル                                    ││
│  ├─────────────────────────────────────────────────────────┤│
│  │ 画像    タイトル     カテゴリ  価格     手数料率 ステータス 申込 評価 アクション││
│  │─────────────────────────────────────────────────────────││
│  │ [IMG] Webサイト制作  IT開発   ¥50,000  30%     [公開中] 12件 ★4.8 [...] ││
│  │       コーポレート                                                     ││
│  │       サイト構築...                                                    ││
│  │                                                                       ││
│  │ [IMG] SEOコンサル    マーケ   ¥30,000  20%     [公開中]  8件 ★4.5 [...] ││
│  │       検索順位改善                                                     ││
│  │       支援サービス                                                     ││
│  │                                                                       ││
│  │ [IMG] ロゴデザイン   IT開発   ¥20,000  40%     [公開中]  5件 ★4.9 [...] ││
│  │       企業ブランド                                                     ││
│  │       ロゴ制作                                                         ││
│  │                                                                       ││
│  │ [IMG] LP制作         IT開発   ¥40,000  30%     [公開中]  7件 ★4.6 [...] ││
│  │       ランディング                                                     ││
│  │       ページ構築                                                       ││
│  │                                                                       ││
│  │ [IMG] 広告運用代行   マーケ   ¥80,000  50%     [公開中] 10件 ★4.7 [...] ││
│  │       Google Ads                                                      ││
│  │       運用サポート                                                     ││
│  │                                                                       ││
│  │ [IMG] 動画編集       IT開発   ¥35,000  30%     [非公開]  0件  -   [...] ││
│  │       プロモーション                                                   ││
│  │       動画制作                                                         ││
│  │                                                                       ││
│  │ [IMG] 経営コンサル   コンサル ¥100,000 50%     [非公開]  0件  -   [...] ││
│  │       事業戦略策定                                                     ││
│  │       支援                                                             ││
│  │                                                                       ││
│  │ [IMG] SNS運用        マーケ   ¥25,000  20%     [公開中]  0件  -   [...] ││
│  │       Instagram                                                       ││
│  │       運用代行                                                         ││
│  │                                                                       ││
│  └─────────────────────────────────────────────────────────┘│
│                                                               │
│  [< Prev] [1] [2] [3] ... [Next >]                           │
│                                                               │
├─────────────────────────────────────────────────────────────┤
│ Footer: About | Terms | Privacy | Contact                    │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────┐
│ アクションドロップダウン（...）     │
├─────────────────────────────────────┤
│ 👁 プレビュー                        │
│ ✏️ 編集                              │
│ 🔄 公開/非公開切り替え              │
│ ──────────────────────────────────  │
│ 🗑 削除                              │
└─────────────────────────────────────┘
```

**要素説明**:

#### ヘッダーエリア
- **ページタイトル**: 「マイサービス」
- **統計カード** (4つ):
  - 総サービス数: 登録したすべてのサービス数
  - 公開中: `isActive = true` のサービス数
  - 非公開: `isActive = false` のサービス数
  - 総申込数: 全サービスの累積申込数（Bookingテーブルから集計）

#### アクションエリア
- **新規サービス作成ボタン**: プライマリボタン（右上配置）
  - クリックで `/sponsor/services/new` へ遷移

#### 検索・フィルターバー
- **検索ボックス**:
  - プレースホルダー: 「サービス名で検索...」
  - 入力時にリアルタイム検索（debounce 300ms）

- **ステータスフィルター**:
  - オプション: すべて / 公開中 / 非公開
  - デフォルト: すべて

- **カテゴリフィルター**:
  - オプション: すべて / IT開発 / コンサルティング / マーケティング / くらし / 投資
  - ServiceCategory enumに対応

- **並び替えドロップダウン**:
  - オプション:
    - 更新日（新しい順）- デフォルト
    - 更新日（古い順）
    - 作成日（新しい順）
    - 作成日（古い順）
    - 申込数（多い順）
    - 申込数（少ない順）
    - 評価（高い順）
    - 評価（低い順）
    - 価格（高い順）
    - 価格（低い順）

#### サービス一覧テーブル

**テーブル列定義**:

| 列名 | 幅 | データ | 説明 |
|------|-----|-------|------|
| 画像 | 80px | `imageUrl` | サービスのサムネイル画像（正方形、角丸） |
| タイトル | 250px | `title`, `description` | タイトル（太字）+ 説明の先頭2行（グレー、小さめ） |
| カテゴリ | 100px | `category` | カテゴリバッジ表示 |
| 価格 | 100px | `price` | ¥形式で表示（カンマ区切り） |
| 手数料率 | 80px | `feeRate` | 20%/30%/40%/50%表示 |
| ステータス | 100px | `isActive` | バッジ表示（公開中=緑、非公開=グレー） |
| 申込 | 60px | Bookingテーブルから集計 | 申込数（件） |
| 評価 | 80px | Reviewテーブルから集計 | ★4.8形式（申込0件は「-」表示） |
| アクション | 60px | - | ドロップダウンメニュー（...アイコン） |

**アクションドロップダウンメニュー**:
- **プレビュー**: 利用者目線でのサービス詳細画面を新しいタブで表示
- **編集**: `/sponsor/services/:id/edit` へ遷移
- **公開/非公開切り替え**:
  - 公開中 → 非公開: 確認ダイアログ表示後、`isActive = false`に更新
  - 非公開 → 公開中: 確認ダイアログ表示後、`isActive = true`に更新
- **削除**:
  - 確認ダイアログ表示（「申込が紐づいている場合は削除できません」警告）
  - 削除条件: 紐づくBookingが0件の場合のみ
  - 削除実行後、トースト通知表示

#### ページネーション
- 1ページあたり10件表示
- 総ページ数を計算して表示
- 前へ/次へボタン + ページ番号リンク

#### 空の状態（サービス未登録時）
```
┌─────────────────────────────────────┐
│                                     │
│         📦                          │
│                                     │
│   まだサービスが登録されていません   │
│                                     │
│   サービスを登録して、               │
│   利用者からの申込を受け付けましょう │
│                                     │
│   [+ 新規サービス作成]              │
│                                     │
└─────────────────────────────────────┘
```

#### データ構造

**サービス一覧API (`GET /api/sponsor/services`)**

**リクエストパラメータ**:
```typescript
interface GetServicesParams {
  page?: number;          // ページ番号（デフォルト: 1）
  limit?: number;         // 1ページあたりの件数（デフォルト: 10）
  search?: string;        // サービス名検索（部分一致）
  status?: 'all' | 'active' | 'inactive';  // ステータスフィルター
  category?: ServiceCategory | 'all';      // カテゴリフィルター
  sortBy?: 'updatedAt' | 'createdAt' | 'bookings' | 'rating' | 'price';
  sortOrder?: 'asc' | 'desc';
}
```

**レスポンス**:
```typescript
interface GetServicesResponse {
  services: ServiceWithStats[];
  pagination: {
    total: number;        // 総件数
    page: number;         // 現在のページ
    limit: number;        // 1ページあたりの件数
    totalPages: number;   // 総ページ数
  };
  stats: {
    total: number;        // 総サービス数
    active: number;       // 公開中
    inactive: number;     // 非公開
    totalBookings: number; // 総申込数
  };
}

interface ServiceWithStats {
  id: string;
  title: string;
  description: string;
  category: ServiceCategory;
  price: number;
  feeRate: FeeRate;
  isActive: boolean;
  imageUrl: string | null;
  createdAt: Date;
  updatedAt: Date;
  bookingCount: number;     // 申込数
  averageRating: number | null;  // 平均評価（レビュー0件の場合はnull）
  reviewCount: number;      // レビュー数
}
```

**公開/非公開切り替えAPI (`PATCH /api/sponsor/services/:id/toggle-active`)**

**リクエスト**:
```typescript
// ボディなし（現在の isActive を反転）
```

**レスポンス**:
```typescript
interface ToggleActiveResponse {
  success: boolean;
  service: {
    id: string;
    isActive: boolean;
  };
  message: string;  // 「サービスを公開しました」または「サービスを非公開にしました」
}
```

**削除API (`DELETE /api/sponsor/services/:id`)**

**レスポンス**:
```typescript
interface DeleteServiceResponse {
  success: boolean;
  message: string;  // 「サービスを削除しました」
}

// エラーレスポンス（申込がある場合）
interface DeleteServiceError {
  success: false;
  error: string;  // 「このサービスには申込が紐づいているため削除できません」
}
```

#### UIコンポーネント

**使用するshadcn/uiコンポーネント**:
- `Card`: 統計カード
- `Button`: 新規作成、アクションボタン
- `Input`: 検索ボックス
- `Select`: フィルター、並び替えドロップダウン
- `Table`: サービス一覧
- `Badge`: ステータス、カテゴリ表示
- `DropdownMenu`: アクションメニュー
- `AlertDialog`: 削除、公開切り替えの確認ダイアログ
- `Toast`: 操作完了通知
- `Skeleton`: ローディング状態

#### インタラクション仕様

1. **検索**:
   - 入力時にdebounce（300ms）
   - 検索中はテーブルにSkeletonを表示
   - 結果0件の場合は空の状態メッセージ表示

2. **フィルター・並び替え**:
   - 変更時に即座にAPIリクエスト
   - ローディング中はテーブルにSkeletonを表示

3. **公開/非公開切り替え**:
   - クリック → 確認ダイアログ表示
   - 確認 → APIリクエスト → 成功時にトースト通知 + テーブル再読み込み

4. **削除**:
   - クリック → 確認ダイアログ表示
   - ダイアログ内容: 「本当にこのサービスを削除しますか？この操作は取り消せません。」
   - 確認 → APIリクエスト
   - 成功: トースト通知「サービスを削除しました」+ テーブル再読み込み
   - 失敗: エラートースト表示「このサービスには申込が紐づいているため削除できません」

5. **プレビュー**:
   - 新しいタブで `/client/services/:id` を開く（利用者視点）

#### レスポンシブ対応

**モバイル（〜768px）**:
- テーブルをカード形式に変換
- 各サービスをカードとして縦積み表示
- カード内容: 画像、タイトル、カテゴリ、価格、ステータス、アクションボタン
- フィルター・並び替えはシート（Sheet）で開閉

**タブレット（768px〜1024px）**:
- テーブル表示維持
- 一部列を非表示（説明、手数料率を省略）

**デスクトップ（1024px〜）**:
- 全列表示

### 5.8 利用者向けマイ申込一覧（Bookings）

```
┌─────────────────────────────────────────────────────────────┐
│ HATAMO Logo              Search Box               [Profile] │
├─────────────────────────────────────────────────────────────┤
│ [ダッシュボード] [サービス] [申込] [メッセージ] [プロフィール]│
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  マイ申込                                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━      │
│                                                               │
│  ┌───────────┬───────────┬───────────┬───────────┐          │
│  │全申込     │進行中     │完了       │キャンセル │          │
│  │12件       │3件        │8件        │1件        │          │
│  │           │⚠要対応    │           │           │          │
│  └───────────┴───────────┴───────────┴───────────┘          │
│                                                               │
│  ┌──────────────────────────────┐                            │
│  │ 🔍 [サービス名・スポンサー名で検索...]                   │
│  └──────────────────────────────┘                            │
│                                                               │
│  ┌────────────┬──────────────┬──────────────┐               │
│  │[ステータス▼]│[カテゴリ ▼] │[並び替え ▼] │               │
│  │            │              │              │               │
│  └────────────┴──────────────┴──────────────┘               │
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ 申込一覧                                                ││
│  ├─────────────────────────────────────────────────────────┤│
│  │ サービス       スポンサー   ステータス  金額     申込日  アクション││
│  │─────────────────────────────────────────────────────────││
│  │ [IMG] Webサイト 田中太郎    [進行中]   ¥50,000  10/01  [詳細] [メッセージ]││
│  │       制作      ★★★★☆                                  ││
│  │                                                         ││
│  │ [IMG] SEOコンサル 佐藤花子  [完了]     ¥30,000  09/28  [詳細] [レビュー]││
│  │                 ★★★★★                                  ││
│  │                                                         ││
│  │ [IMG] ロゴデザイン 山田一郎  [承認待ち] ¥20,000  09/25  [詳細] [決済]││
│  │                   ★★★★☆                                ││
│  │                                                         ││
│  │ [IMG] LP制作     鈴木次郎   [申込中]   ¥40,000  09/20  [詳細] [キャンセル]││
│  │                 ★★★★★                                  ││
│  │                                                         ││
│  └─────────────────────────────────────────────────────────┘│
│                                                               │
│  [< Prev] [1] [2] [3] ... [Next >]                           │
│                                                               │
├─────────────────────────────────────────────────────────────┤
│ Footer: About | Terms | Privacy | Contact                    │
└─────────────────────────────────────────────────────────────┘
```

**要素説明**:

#### ヘッダーエリア
- **ページタイトル**: 「マイ申込」
- **統計カード** (4つ):
  - 全申込: すべてのBooking数
  - 進行中: `ACCEPTED`, `PAID`, `IN_PROGRESS` の合計（要対応バッジ付き）
  - 完了: `COMPLETED` 状態のBooking数
  - キャンセル: `CANCELLED`, `REFUNDED` の合計

#### 検索・フィルターバー

- **検索ボックス**:
  - プレースホルダー: 「サービス名・スポンサー名で検索...」
  - 入力時にリアルタイム検索（debounce 300ms）
  - Service.title、Sponsor.nameで検索

- **ステータスフィルター**:
  - オプション:
    - すべて（デフォルト）
    - 申込中（PENDING）
    - 承認待ち（ACCEPTED）- 決済が必要
    - 決済済み（PAID）
    - 進行中（IN_PROGRESS）
    - 完了（COMPLETED）
    - キャンセル（CANCELLED, REFUNDED）

- **カテゴリフィルター**:
  - オプション: すべて / IT開発 / コンサルティング / マーケティング / くらし / 投資
  - ServiceCategory enumに対応

- **並び替えドロップダウン**:
  - オプション:
    - 申込日（新しい順）- デフォルト
    - 申込日（古い順）
    - 更新日（新しい順）
    - 更新日（古い順）
    - 金額（高い順）
    - 金額（低い順）

#### 申込一覧テーブル

**テーブル列定義**:

| 列名 | 幅 | データ | 説明 |
|------|-----|-------|------|
| サービス | 250px | `Service.imageUrl`, `Service.title` | サムネイル画像 + サービスタイトル |
| スポンサー | 150px | `Sponsor.name`, 平均評価 | スポンサー名 + 星評価 |
| ステータス | 120px | `status` | ステータスバッジ（色分け） |
| 金額 | 100px | `totalPrice` | ¥形式で表示（カンマ区切り） |
| 申込日 | 100px | `createdAt` | MM/DD形式 |
| アクション | 180px | - | ステータスに応じたアクションボタン |

**ステータスバッジの色分け**:

| ステータス | バッジ色 | テキスト |
|-----------|---------|---------|
| PENDING | 黄色（yellow-100/yellow-800） | 申込中 |
| ACCEPTED | オレンジ（orange-100/orange-800） | 承認待ち |
| PAID | 青（blue-100/blue-800） | 決済済み |
| IN_PROGRESS | 紫（purple-100/purple-800） | 進行中 |
| COMPLETED | 緑（green-100/green-800） | 完了 |
| CANCELLED | グレー（gray-100/gray-800） | キャンセル |
| REFUNDED | グレー（gray-100/gray-800） | 返金済み |

**ステータス別アクション**:

| ステータス | アクションボタン | 動作 |
|-----------|----------------|------|
| PENDING | [詳細] [キャンセル] | 詳細表示、キャンセル確認ダイアログ |
| ACCEPTED | [詳細] [決済へ進む] | 詳細表示、決済画面へ遷移 |
| PAID | [詳細] [メッセージ] | 詳細表示、メッセージ画面へ遷移 |
| IN_PROGRESS | [詳細] [メッセージ] | 詳細表示、メッセージ画面へ遷移 |
| COMPLETED | [詳細] [レビュー] | 詳細表示、レビュー投稿画面へ遷移（未投稿の場合のみ） |
| CANCELLED/REFUNDED | [詳細] | 詳細表示のみ |

#### ページネーション
- 1ページあたり10件表示
- 総ページ数を計算して表示
- 前へ/次へボタン + ページ番号リンク

#### 空の状態（申込未登録時）
```
┌─────────────────────────────────────┐
│                                     │
│         📋                          │
│                                     │
│   まだ申込がありません               │
│                                     │
│   気になるサービスを見つけて、       │
│   申し込んでみましょう               │
│                                     │
│   [サービスを探す]                  │
│                                     │
└─────────────────────────────────────┘
```

#### データ構造

**申込一覧API (`GET /api/client/bookings`)**

**リクエストパラメータ**:
```typescript
interface GetBookingsParams {
  page?: number;          // ページ番号（デフォルト: 1）
  limit?: number;         // 1ページあたりの件数（デフォルト: 10）
  search?: string;        // サービス名・スポンサー名検索（部分一致）
  status?: BookingStatus | 'all';  // ステータスフィルター
  category?: ServiceCategory | 'all';  // カテゴリフィルター
  sortBy?: 'createdAt' | 'updatedAt' | 'totalPrice';
  sortOrder?: 'asc' | 'desc';
}
```

**レスポンス**:
```typescript
interface GetBookingsResponse {
  bookings: BookingWithDetails[];
  pagination: {
    total: number;        // 総件数
    page: number;         // 現在のページ
    limit: number;        // 1ページあたりの件数
    totalPages: number;   // 総ページ数
  };
  stats: {
    total: number;        // 全申込数
    inProgress: number;   // 進行中（ACCEPTED, PAID, IN_PROGRESS）
    completed: number;    // 完了（COMPLETED）
    cancelled: number;    // キャンセル（CANCELLED, REFUNDED）
  };
}

interface BookingWithDetails {
  id: string;
  status: BookingStatus;
  totalPrice: number;
  createdAt: Date;
  updatedAt: Date;
  completedAt: Date | null;
  service: {
    id: string;
    title: string;
    category: ServiceCategory;
    imageUrl: string | null;
  };
  sponsor: {
    id: string;
    name: string;
    profileImage: string | null;
    averageRating: number | null;
  };
  hasReview: boolean;  // レビュー投稿済みかどうか
}
```

**キャンセルAPI (`POST /api/client/bookings/:id/cancel`)**

**リクエスト**:
```typescript
interface CancelBookingRequest {
  reason?: string;  // キャンセル理由（任意、最大500文字）
}
```

**レスポンス**:
```typescript
interface CancelBookingResponse {
  success: boolean;
  booking: {
    id: string;
    status: BookingStatus;  // CANCELLED
  };
  message: string;  // 「申込をキャンセルしました」
}

// エラーレスポンス（キャンセル不可の場合）
interface CancelBookingError {
  success: false;
  error: string;  // 「この申込はキャンセルできません（決済済み）」
}
```

**キャンセル可能条件**:
- ステータスが `PENDING` または `ACCEPTED` の場合のみ
- `PAID` 以降は返金処理が必要なため別フロー

#### UIコンポーネント

**使用するshadcn/uiコンポーネント**:
- `Card`: 統計カード
- `Button`: アクションボタン
- `Input`: 検索ボックス
- `Select`: フィルター、並び替えドロップダウン
- `Table`: 申込一覧
- `Badge`: ステータス表示
- `AlertDialog`: キャンセル確認ダイアログ
- `Toast`: 操作完了通知
- `Skeleton`: ローディング状態
- `Avatar`: スポンサーアバター

#### インタラクション仕様

1. **検索**:
   - 入力時にdebounce（300ms）
   - 検索中はテーブルにSkeletonを表示
   - 結果0件の場合は空の状態メッセージ表示

2. **フィルター・並び替え**:
   - 変更時に即座にAPIリクエスト
   - ローディング中はテーブルにSkeletonを表示

3. **キャンセル**:
   - クリック → 確認ダイアログ表示
   - ダイアログ内容: 「この申込をキャンセルしますか？」+ キャンセル理由入力欄（任意）
   - 確認 → APIリクエスト
   - 成功: トースト通知「申込をキャンセルしました」+ テーブル再読み込み
   - 失敗: エラートースト表示

4. **決済へ進む**:
   - `/client/bookings/:id/payment` へ遷移
   - Stripe決済画面表示

5. **レビュー投稿**:
   - `/client/bookings/:id/review` へ遷移
   - レビュー投稿フォーム表示

6. **詳細表示**:
   - `/client/bookings/:id` へ遷移
   - 申込詳細画面表示（5.10参照）

#### レスポンシブ対応

**モバイル（〜768px）**:
- テーブルをカード形式に変換
- 各申込をカードとして縦積み表示
- カード内容: サービス画像、タイトル、スポンサー名、ステータス、金額、アクションボタン
- フィルター・並び替えはシート（Sheet）で開閉

**タブレット（768px〜1024px）**:
- テーブル表示維持
- 一部列を非表示（スポンサー評価を省略）

**デスクトップ（1024px〜）**:
- 全列表示

---

### 5.9 スポンサー向け申込管理（Bookings）

**画面の役割**:
- **ダッシュボードトップとの違い**:
  - **ダッシュボード（/sponsor/dashboard）**: 最新の申込状況を一目で把握（最新5件程度表示）+ クイックアクション
  - **申込管理タブ（/sponsor/bookings）**: 全申込の詳細管理・検索・フィルタリング機能
- **導線**: ダッシュボードの「新規申込」「進行中のサービス」セクションにある「すべて見る」ボタンからこの画面へ遷移

**用途**:
- 全申込の一覧表示と詳細管理
- ステータス別・サービス別フィルタリング
- 高度な検索機能（クライアント名・サービス名）
- 過去の申込履歴の確認
- 申込件数が増えた場合のスケーラブルな管理

```
┌─────────────────────────────────────────────────────────────┐
│ HATAMO Logo              [Messages] [Notifications] [田中]  │
├─────────────────────────────────────────────────────────────┤
│ [Dashboard] [Services] [Bookings] [Messages] [Revenue]       │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  申込管理                                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━      │
│                                                               │
│  ┌───────────┬───────────┬───────────┬───────────┐          │
│  │全申込     │承認待ち   │進行中     │完了       │          │
│  │25件       │3件 ⚠     │8件        │12件       │          │
│  │           │要対応     │           │           │          │
│  └───────────┴───────────┴───────────┴───────────┘          │
│                                                               │
│  ┌──────────────────────────────┐                            │
│  │ 🔍 [クライアント名・サービス名で検索...]                 │
│  └──────────────────────────────┘                            │
│                                                               │
│  ┌────────────┬──────────────┬──────────────┐               │
│  │[ステータス▼]│[サービス ▼] │[並び替え ▼] │               │
│  │            │              │              │               │
│  └────────────┴──────────────┴──────────────┘               │
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ 申込一覧                                                ││
│  ├─────────────────────────────────────────────────────────┤│
│  │ サービス     クライアント ステータス  金額/受取額  申込日  アクション││
│  │─────────────────────────────────────────────────────────││
│  │ Webサイト制作 [🧑]佐藤花子  [承認待ち] ¥50,000    10/01  [承認] [拒否]││
│  │                                        ↓¥32,500           [詳細]││
│  │                                                         ││
│  │ SEOコンサル   [🧑]山田一郎  [進行中]   ¥30,000    09/28  [完了マーク]││
│  │                                        ↓¥21,000           [詳細]││
│  │                                                         ││
│  │ ロゴデザイン  [🧑]鈴木次郎  [決済済み] ¥20,000    09/25  [作業開始]││
│  │                                        ↓¥10,000           [詳細]││
│  │                                                         ││
│  │ LP制作        [🧑]田中太郎  [完了]     ¥40,000    09/20  [詳細]││
│  │                                        ↓¥26,000           [レビュー]││
│  │                                                         ││
│  └─────────────────────────────────────────────────────────┘│
│                                                               │
│  [< Prev] [1] [2] [3] ... [Next >]                           │
│                                                               │
├─────────────────────────────────────────────────────────────┤
│ Footer: About | Terms | Privacy | Contact                    │
└─────────────────────────────────────────────────────────────┘
```

**要素説明**:

#### ヘッダーエリア
- **ページタイトル**: 「申込管理」
- **統計カード** (4つ):
  - 全申込: すべての受信Booking数
  - 承認待ち: `PENDING` 状態のBooking数（⚠要対応バッジ付き）
  - 進行中: `ACCEPTED`, `PAID`, `IN_PROGRESS` の合計
  - 完了: `COMPLETED` 状態のBooking数

#### 検索・フィルターバー

- **検索ボックス**:
  - プレースホルダー: 「クライアント名・サービス名で検索...」
  - 入力時にリアルタイム検索（debounce 300ms）
  - Client.name、Service.titleで検索

- **ステータスフィルター**:
  - オプション:
    - すべて（デフォルト）
    - 承認待ち（PENDING）- 最重要
    - 承認済み（ACCEPTED）
    - 決済済み（PAID）
    - 進行中（IN_PROGRESS）
    - 完了確認待ち（AWAITING_COMPLETION）- 新規追加
    - 完了（COMPLETED）
    - 拒否・キャンセル（CANCELLED, REFUNDED）

- **サービスフィルター**:
  - オプション: 自分が提供しているサービスのリスト
  - 「すべてのサービス」がデフォルト

- **並び替えドロップダウン**:
  - オプション:
    - 申込日（新しい順）- デフォルト
    - 申込日（古い順）
    - 更新日（新しい順）
    - 更新日（古い順）
    - 金額（高い順）
    - 金額（低い順）

#### 申込一覧テーブル

**テーブル列定義**:

| 列名 | 幅 | データ | 説明 |
|------|-----|-------|------|
| サービス | 180px | `Service.title` | 自分が提供しているサービス名 |
| クライアント | 150px | `Client.name`, `Client.profileImage` | アバター + クライアント名 |
| ステータス | 120px | `status` | ステータスバッジ（色分け） |
| 金額/受取額 | 140px | `totalPrice`, `feeAmount` | 総額と手数料控除後の受取額を2段表示 |
| 申込日 | 100px | `createdAt` | MM/DD形式 |
| アクション | 200px | - | ステータスに応じたアクションボタン |

**金額/受取額の表示形式**:
```
¥50,000         ← 総額（totalPrice）
↓¥32,500        ← 受取額（totalPrice - feeAmount）
```

**手数料計算ロジック**:
```typescript
// feeAmount = totalPrice × (feeRate + 5%)
// 受取額 = totalPrice - feeAmount

例: totalPrice = ¥50,000、feeRate = 30%
feeAmount = ¥50,000 × (30% + 5%) = ¥50,000 × 35% = ¥17,500
受取額 = ¥50,000 - ¥17,500 = ¥32,500
```

**ステータス別アクション**:

| ステータス | アクションボタン | 動作 |
|-----------|----------------|------|
| PENDING | [承認] [拒否] [詳細] | 承認/拒否確認ダイアログ、詳細表示 |
| ACCEPTED | [詳細] [メッセージ] [キャンセル] | 詳細表示、メッセージ、キャンセル |
| PAID | [作業開始] [詳細] [メッセージ] | IN_PROGRESSへ更新、詳細表示、メッセージ |
| IN_PROGRESS | [完了マーク] [詳細] [メッセージ] | AWAITING_COMPLETIONへ更新、詳細表示、メッセージ |
| AWAITING_COMPLETION | [詳細] [メッセージ] | 詳細表示、メッセージ（利用者の承認待ち） |
| COMPLETED | [詳細] [レビュー確認] | 詳細表示、レビュー表示 |
| CANCELLED/REFUNDED | [詳細] | 詳細表示のみ |

---

#### ステータス遷移フロー詳細

**全体フロー図**:

```
PENDING（承認待ち）
    ↓ [承認]クリック              ↓ [拒否]クリック
    ↓                             ↓
ACCEPTED（承認済み）            REJECTED（拒否）
    ↓ 利用者が決済               → 終了
    ↓
PAID（決済完了）
    ↓ [作業開始]クリック
    ↓
IN_PROGRESS（作業中）
    ↓ [完了マーク]クリック
    ↓
AWAITING_COMPLETION（完了確認待ち）★新規追加
    ↓ 利用者が承認              ↓ 利用者が修正依頼
    ↓                             ↓
    ↓                        IN_PROGRESS に戻る
    ↓                        （スポンサーが修正対応）
    ↓                             ↓
    ↓ ←───────────────────────────┘
    ↓
COMPLETED（完了）
    ↓ 利用者がレビュー投稿
    ↓
レビュー投稿完了 → 売上確定 → 精算処理へ
```

**各ステータスの詳細説明**:

##### 1️⃣ PENDING（承認待ち）
- **状態**: 利用者が申込を送信、スポンサーの承認待ち
- **決済状況**: 未実施
- **スポンサーアクション**:
  - [承認]: 確認ダイアログ表示 → ACCEPTEDへ遷移 → 利用者に通知
  - [拒否]: 理由入力フォーム表示 → REJECTEDへ遷移 → 利用者に通知
  - [詳細]: 申込詳細ページへ遷移

##### 2️⃣ ACCEPTED（承認済み）
- **状態**: スポンサーが承認、利用者の決済待ち
- **決済状況**: 未実施（利用者が決済処理を実行すると自動的にPAIDへ）
- **スポンサーアクション**:
  - [詳細]: 申込詳細ページへ遷移
  - [メッセージ]: 利用者とチャット（決済前の最終確認など）
  - [キャンセル]: 確認ダイアログ → CANCELLEDへ遷移 → 利用者に通知

##### 3️⃣ PAID（決済完了）
- **状態**: 利用者がStripe決済完了、スポンサーの作業開始待ち
- **決済状況**: 完了（Stripe決済ID記録済み）
- **スポンサーアクション**:
  - [作業開始]: 確認ダイアログ → IN_PROGRESSへ遷移 → 利用者に通知
  - [詳細]: 申込詳細ページへ遷移（決済情報確認可能）
  - [メッセージ]: 利用者と作業内容の詳細確認

##### 4️⃣ IN_PROGRESS（作業中）
- **状態**: スポンサーがサービス提供実施中
- **決済状況**: 完了
- **スポンサーアクション**:
  - [完了マーク]: 確認ダイアログ → AWAITING_COMPLETIONへ遷移 → 利用者に「成果物確認依頼」通知
  - [詳細]: 申込詳細ページへ遷移
  - [メッセージ]: 利用者と作業進捗を共有

##### 5️⃣ AWAITING_COMPLETION（完了確認待ち）★新規追加
- **状態**: スポンサーが作業完了を報告、利用者の承認待ち
- **決済状況**: 完了
- **売上確定**: 未確定（利用者の承認後に確定）
- **スポンサーアクション**:
  - [詳細]: 申込詳細ページへ遷移（「利用者の承認待ちです」と表示）
  - [メッセージ]: 利用者と最終確認のやり取り
- **利用者アクション**:
  - [完了を承認]: 成果物確認後、COMPLETEDへ遷移 → スポンサー・利用者に通知 → 売上確定
  - [修正を依頼]: 修正内容入力 → IN_PROGRESSへ戻る → スポンサーに通知

**利用者画面（AWAITING_COMPLETION時）**:
```
┌─────────────────────────────────────────────────┐
│ ✅ スポンサーが作業完了を報告しました。          │
│    成果物を確認して、完了を承認してください。    │
│                                                  │
│ [成果物を確認]                                   │
│ [完了を承認] [修正を依頼]                        │
└─────────────────────────────────────────────────┘
```

**修正依頼フロー**:
```
[利用者が「修正を依頼」クリック]
    ↓
[修正内容入力フォーム表示]
    ↓
[送信] → Booking.status を IN_PROGRESS に戻す
    ↓
[BookingRevisionRequest レコード作成]
    ↓
[スポンサーにメール/LINE通知: 「修正依頼がありました」+ 修正内容]
    ↓
[スポンサーが修正対応]
    ↓
[再度「完了マーク」クリック] → AWAITING_COMPLETION へ
    ↓
[利用者が承認] → COMPLETED へ
```

##### 6️⃣ COMPLETED（完了）
- **状態**: 利用者が完了を承認、サービス完了
- **決済状況**: 完了
- **売上確定**: 確定（精算処理対象）
- **スポンサーアクション**:
  - [詳細]: 申込詳細ページへ遷移
  - [レビュー確認]: レビュー投稿済みの場合は内容表示、未投稿の場合は「未投稿」表示
- **利用者アクション**:
  - [レビューを投稿]: レビュー投稿フォームへ遷移

**利用者画面（COMPLETED時）**:
```
┌─────────────────────────────────────────────────┐
│ ✅ サービスが完了しました！                      │
│    レビューを投稿してください。                  │
│                                                  │
│ [レビューを投稿]                                 │
└─────────────────────────────────────────────────┘
```

##### 7️⃣ CANCELLED / REFUNDED
- **CANCELLED**: 決済前のキャンセル
- **REFUNDED**: 決済後のキャンセル、返金処理完了
- **スポンサーアクション**:
  - [詳細]: 申込詳細ページへ遷移（キャンセル理由、返金情報確認）

---

#### ページネーション
- 1ページあたり10件表示
- 総ページ数を計算して表示
- 前へ/次へボタン + ページ番号リンク

#### 空の状態（申込未受信時）
```
┌─────────────────────────────────────┐
│                                     │
│         📬                          │
│                                     │
│   まだ申込がありません               │
│                                     │
│   サービスを登録して、               │
│   申込を受け付けましょう             │
│                                     │
│   [サービスを登録]                  │
│                                     │
└─────────────────────────────────────┘
```

#### データ構造

**申込一覧API (`GET /api/sponsor/bookings`)**

**リクエストパラメータ**:
```typescript
interface GetSponsorBookingsParams {
  page?: number;
  limit?: number;
  search?: string;        // クライアント名・サービス名検索
  status?: BookingStatus | 'all';
  serviceId?: string | 'all';  // サービスフィルター
  sortBy?: 'createdAt' | 'updatedAt' | 'totalPrice';
  sortOrder?: 'asc' | 'desc';
}
```

**レスポンス**:
```typescript
interface GetSponsorBookingsResponse {
  bookings: SponsorBookingWithDetails[];
  pagination: {
    total: number;
    page: number;
    limit: number;
    totalPages: number;
  };
  stats: {
    total: number;        // 全申込数
    pending: number;      // 承認待ち（PENDING）
    inProgress: number;   // 進行中（ACCEPTED, PAID, IN_PROGRESS）
    completed: number;    // 完了（COMPLETED）
  };
  services: ServiceOption[];  // サービスフィルター用
}

interface SponsorBookingWithDetails {
  id: string;
  status: BookingStatus;
  totalPrice: number;
  feeAmount: number;
  receiveAmount: number;  // totalPrice - feeAmount
  createdAt: Date;
  updatedAt: Date;
  completedAt: Date | null;
  service: {
    id: string;
    title: string;
    feeRate: FeeRate;
  };
  client: {
    id: string;
    name: string;
    profileImage: string | null;
  };
  hasReview: boolean;
}

interface ServiceOption {
  id: string;
  title: string;
}
```

**承認API (`POST /api/sponsor/bookings/:id/accept`)**

**リクエスト**:
```typescript
interface AcceptBookingRequest {
  message?: string;  // 承認メッセージ（任意、クライアントへ送信）
}
```

**レスポンス**:
```typescript
interface AcceptBookingResponse {
  success: boolean;
  booking: {
    id: string;
    status: BookingStatus;  // ACCEPTED
  };
  message: string;  // 「申込を承認しました」
}
```

**拒否API (`POST /api/sponsor/bookings/:id/reject`)**

**リクエスト**:
```typescript
interface RejectBookingRequest {
  reason: string;  // 拒否理由（必須、最大500文字）
}
```

**レスポンス**:
```typescript
interface RejectBookingResponse {
  success: boolean;
  booking: {
    id: string;
    status: BookingStatus;  // CANCELLED
  };
  message: string;  // 「申込を拒否しました」
}
```

**作業開始API (`POST /api/sponsor/bookings/:id/start`)**

**レスポンス**:
```typescript
interface StartBookingResponse {
  success: boolean;
  booking: {
    id: string;
    status: BookingStatus;  // IN_PROGRESS
  };
  message: string;  // 「作業を開始しました」
}
```

**完了マークAPI (`POST /api/sponsor/bookings/:id/complete`)**

**リクエスト**:
```typescript
interface CompleteBookingRequest {
  completionNote?: string;  // 完了コメント（任意）
}
```

**レスポンス**:
```typescript
interface CompleteBookingResponse {
  success: boolean;
  booking: {
    id: string;
    status: BookingStatus;  // COMPLETED
    completedAt: Date;
  };
  message: string;  // 「サービスを完了としてマークしました」
}
```

#### UIコンポーネント

**使用するshadcn/uiコンポーネント**:
- `Card`: 統計カード
- `Button`: アクションボタン
- `Input`: 検索ボックス
- `Select`: フィルター、並び替えドロップダウン
- `Table`: 申込一覧
- `Badge`: ステータス表示
- `AlertDialog`: 承認/拒否/完了確認ダイアログ
- `Textarea`: 拒否理由、完了コメント入力
- `Toast`: 操作完了通知
- `Skeleton`: ローディング状態
- `Avatar`: クライアントアバター

#### インタラクション仕様

1. **検索**:
   - 入力時にdebounce（300ms）
   - 検索中はテーブルにSkeletonを表示
   - 結果0件の場合は空の状態メッセージ表示

2. **フィルター・並び替え**:
   - 変更時に即座にAPIリクエスト
   - ローディング中はテーブルにSkeletonを表示

3. **承認**:
   - クリック → 確認ダイアログ表示
   - ダイアログ内容: 「この申込を承認しますか？」+ メッセージ入力欄（任意）
   - 確認 → APIリクエスト
   - 成功: トースト通知「申込を承認しました。クライアントに通知を送信しました」+ テーブル再読み込み

4. **拒否**:
   - クリック → 確認ダイアログ表示
   - ダイアログ内容: 「この申込を拒否しますか？」+ 拒否理由入力欄（必須）
   - 確認 → APIリクエスト
   - 成功: トースト通知「申込を拒否しました」+ テーブル再読み込み
   - バリデーション: 拒否理由が未入力の場合はエラー表示

5. **作業開始**:
   - クリック → 確認ダイアログ表示
   - ダイアログ内容: 「作業を開始しますか？」
   - 確認 → APIリクエスト → ステータスをIN_PROGRESSに更新
   - 成功: トースト通知「作業を開始しました」

6. **完了マーク**:
   - クリック → 確認ダイアログ表示
   - ダイアログ内容: 「このサービスを完了としてマークしますか？」+ 完了コメント入力欄（任意）
   - 確認 → APIリクエスト → ステータスをCOMPLETEDに更新
   - 成功: トースト通知「サービスを完了としてマークしました。クライアントにレビュー依頼を送信しました」

7. **詳細表示**:
   - `/sponsor/bookings/:id` へ遷移
   - 申込詳細画面表示（5.10参照）

#### レスポンシブ対応

**モバイル（〜768px）**:
- テーブルをカード形式に変換
- 各申込をカードとして縦積み表示
- カード内容: サービス名、クライアント名、ステータス、金額/受取額、アクションボタン
- フィルター・並び替えはシート（Sheet）で開閉

**タブレット（768px〜1024px）**:
- テーブル表示維持
- 金額/受取額を1行にまとめて表示（¥50,000 / ¥32,500）

**デスクトップ（1024px〜）**:
- 全列表示

---

### 5.10 申込詳細画面（利用者・スポンサー共通）

```
┌─────────────────────────────────────────────────────────────┐
│ HATAMO Logo              Search Box               [Profile] │
├─────────────────────────────────────────────────────────────┤
│ Home > 申込 > Webサイト制作の申込                            │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  申込詳細                                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━      │
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ ステータス進行バー                                      ││
│  ├─────────────────────────────────────────────────────────┤│
│  │                                                         ││
│  │  [●]━━[●]━━[●]━━[●]━━[●]━━[○]                          ││
│  │ 申込中 承認 決済 進行中 確認待ち 完了                   ││
│  │ 10/01 10/02 10/03 10/04  10/05   -                     ││
│  │                                                         ││
│  └─────────────────────────────────────────────────────────┘│
│                                                               │
│  ┌────────────────────┬────────────────────────────────────┐│
│  │ 申込情報           │  アクション                        ││
│  ├────────────────────┼────────────────────────────────────┤│
│  │ 申込番号:          │  [メッセージを送る]                ││
│  │ #BK-2024-001       │                                    ││
│  │                    │  [決済へ進む]                      ││
│  │ サービス:          │                                    ││
│  │ [IMG] Webサイト制作│  [キャンセル]                      ││
│  │                    │                                    ││
│  │ スポンサー:        │  ※利用者視点の場合                ││
│  │ 田中太郎           │                                    ││
│  │ ★★★★☆ 4.5        │  ※スポンサー視点の場合:           ││
│  │                    │  [承認] [拒否]                     ││
│  │ 金額:              │  [作業開始] [完了マーク]           ││
│  │ ¥50,000            │                                    ││
│  │                    │                                    ││
│  │ 手数料:            │                                    ││
│  │ ¥17,500 (35%)      │                                    ││
│  │                    │                                    ││
│  │ 受取額（スポンサー）:│                                  ││
│  │ ¥32,500            │                                    ││
│  │                    │                                    ││
│  │ ステータス:        │                                    ││
│  │ [決済済み]         │                                    ││
│  │                    │                                    ││
│  │ 申込日:            │                                    ││
│  │ 2024/10/01 14:30   │                                    ││
│  │                    │                                    ││
│  │ 更新日:            │                                    ││
│  │ 2024/10/03 10:15   │                                    ││
│  └────────────────────┴────────────────────────────────────┘│
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ アクティビティタイムライン                              ││
│  ├─────────────────────────────────────────────────────────┤│
│  │                                                         ││
│  │  ● 2024/10/03 10:15                                    ││
│  │    決済が完了しました                                   ││
│  │    決済ID: pi_1234567890                               ││
│  │                                                         ││
│  │  ● 2024/10/02 16:45                                    ││
│  │    スポンサーが申込を承認しました                       ││
│  │    メッセージ: 「ありがとうございます。お受けします」   ││
│  │                                                         ││
│  │  ● 2024/10/01 14:30                                    ││
│  │    申込を受け付けました                                 ││
│  │                                                         ││
│  └─────────────────────────────────────────────────────────┘│
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ サービス詳細                            [サービスページ] ││
│  ├─────────────────────────────────────────────────────────┤│
│  │                                                         ││
│  │  [IMG]                                                  ││
│  │                                                         ││
│  │  Webサイト制作                                          ││
│  │  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━      ││
│  │                                                         ││
│  │  コーポレートサイト構築サービス...（説明文）            ││
│  │                                                         ││
│  │  カテゴリ: IT開発                                       ││
│  │  基本料金: ¥50,000〜                                    ││
│  │                                                         ││
│  └─────────────────────────────────────────────────────────┘│
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ メッセージ履歴                        [すべて表示]      ││
│  ├─────────────────────────────────────────────────────────┤│
│  │                                                         ││
│  │  田中太郎 (スポンサー)                      10/03 10:20 ││
│  │  「決済ありがとうございました。早速着手します」         ││
│  │                                                         ││
│  │  あなた (利用者)                            10/02 17:00 ││
│  │  「承認ありがとうございます。よろしくお願いします」     ││
│  │                                                         ││
│  │  田中太郎 (スポンサー)                      10/02 16:45 ││
│  │  「ありがとうございます。お受けします」                 ││
│  │                                                         ││
│  │  [メッセージ入力欄...]                          [送信]  ││
│  │                                                         ││
│  └─────────────────────────────────────────────────────────┘│
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ 修正依頼 ★AWAITING_COMPLETION時のみ表示                ││
│  ├─────────────────────────────────────────────────────────┤│
│  │                                                         ││
│  │  🔧 利用者から修正依頼があります                         ││
│  │                                                         ││
│  │  ┌───────────────────────────────────────────────────┐  ││
│  │  │ 修正依頼内容:                                     │  ││
│  │  │ ─────────────────────────────────────────────────│  ││
│  │  │                                                   │  ││
│  │  │ ヘッダーのロゴサイズを少し大きくしてほしいです。    │  ││
│  │  │ また、フッターのリンク色を青に変更してください。    │  ││
│  │  │                                                   │  ││
│  │  │ 依頼者: 佐藤花子                                   │  ││
│  │  │ 依頼日時: 2024/10/05 14:30                        │  ││
│  │  └───────────────────────────────────────────────────┘  ││
│  │                                                         ││
│  │  [修正対応完了] [メッセージで確認]                      ││
│  │                                                         ││
│  └─────────────────────────────────────────────────────────┘│
│                                                               │
├─────────────────────────────────────────────────────────────┤
│ Footer: About | Terms | Privacy | Contact                    │
└─────────────────────────────────────────────────────────────┘
```

**要素説明**:

#### ステータス進行バー

**表示形式**:
- **6つのステップ**: 申込中 → 承認 → 決済 → 進行中 → 確認待ち → 完了
- 完了ステップは●（塗りつぶし）、未完了は○（白抜き）
- 各ステップの下に完了日時を表示（未完了は「-」）

**ステータスとステップのマッピング**:

| BookingStatus | 進行バー状態 |
|---------------|-------------|
| PENDING | [●]━━[○]━━[○]━━[○]━━[○]━━[○] |
| ACCEPTED | [●]━━[●]━━[○]━━[○]━━[○]━━[○] |
| PAID | [●]━━[●]━━[●]━━[○]━━[○]━━[○] |
| IN_PROGRESS | [●]━━[●]━━[●]━━[●]━━[○]━━[○] |
| AWAITING_COMPLETION | [●]━━[●]━━[●]━━[●]━━[●]━━[○] |
| COMPLETED | [●]━━[●]━━[●]━━[●]━━[●]━━[●] |
| CANCELLED/REFUNDED | [●]━━[×]（キャンセル表示） |

#### 申込情報エリア

**表示項目**:

| 項目 | 利用者視点 | スポンサー視点 |
|------|-----------|---------------|
| 申込番号 | 表示 | 表示 |
| サービス | 表示（画像+タイトル） | 表示（画像+タイトル） |
| 相手情報 | スポンサー名+評価 | クライアント名+アバター |
| 金額 | totalPrice | totalPrice |
| 手数料 | 表示（参考情報） | feeAmount（内訳表示） |
| 受取額 | - | totalPrice - feeAmount（重要） |
| ステータス | ステータスバッジ | ステータスバッジ |
| 申込日 | createdAt | createdAt |
| 更新日 | updatedAt | updatedAt |
| 完了日 | completedAt（完了時のみ） | completedAt（完了時のみ） |

#### アクションエリア

**利用者視点のアクション**:

| ステータス | アクション |
|-----------|-----------|
| PENDING | [メッセージを送る] [キャンセル] |
| ACCEPTED | [決済へ進む] [メッセージを送る] [キャンセル] |
| PAID | [メッセージを送る] |
| IN_PROGRESS | [メッセージを送る] |
| AWAITING_COMPLETION | [完了を承認] [修正を依頼] [メッセージを送る] |
| COMPLETED | [レビューを投稿] [メッセージを送る] |
| CANCELLED/REFUNDED | [メッセージを送る]（読み取り専用） |

**スポンサー視点のアクション**:

| ステータス | アクション |
|-----------|-----------|
| PENDING | [承認] [拒否] [メッセージを送る] |
| ACCEPTED | [メッセージを送る] [キャンセル] |
| PAID | [作業開始] [メッセージを送る] |
| IN_PROGRESS | [完了マーク] [メッセージを送る] |
| AWAITING_COMPLETION | [メッセージを送る] + 「⏳ 利用者の承認待ちです」メッセージ表示 |
| COMPLETED | [レビューを確認] [メッセージを送る] |
| CANCELLED/REFUNDED | [メッセージを送る]（読み取り専用） |

#### アクティビティタイムライン

**表示内容**:
- 時系列でイベントを表示（新しい順）
- イベント種類:
  - 申込受付
  - 承認/拒否（メッセージ付き）
  - 決済完了（決済ID付き）
  - 作業開始
  - **完了報告（スポンサーが完了マークをクリック）** ★新規
  - **修正依頼（利用者が修正依頼を送信）** ★新規
  - **完了承認（利用者が完了を承認）** ★新規
  - レビュー投稿
  - キャンセル（理由付き）

**データ構造**:
```typescript
interface ActivityEvent {
  id: string;
  type: 'CREATED' | 'ACCEPTED' | 'REJECTED' | 'PAID' | 'STARTED' |
        'COMPLETION_REPORTED' | 'REVISION_REQUESTED' | 'COMPLETION_APPROVED' |
        'COMPLETED' | 'REVIEWED' | 'CANCELLED';
  timestamp: Date;
  actor: 'CLIENT' | 'SPONSOR' | 'SYSTEM';
  message?: string;
  metadata?: Record<string, any>;  // 決済ID、修正依頼内容など追加情報
}
```

#### サービス詳細エリア

- サービスの基本情報を表示
- サービス詳細ページへのリンク
- 画像、タイトル、説明（抜粋）、カテゴリ、価格

#### メッセージ履歴エリア

- 最新3件のメッセージを表示
- 「すべて表示」ボタンでメッセージ詳細画面へ遷移
- インライン返信機能（入力欄+送信ボタン）

#### 修正依頼エリア ★新規追加

**表示条件**: `status === 'AWAITING_COMPLETION'` かつ修正依頼が存在する場合のみ表示

**ワイヤーフレーム**:
```
┌─────────────────────────────────────────────────────────┐
│ 修正依頼                                                │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  🔧 利用者から修正依頼があります                         │
│                                                         │
│  ┌───────────────────────────────────────────────────┐  │
│  │ 修正依頼内容:                                     │  │
│  │ ─────────────────────────────────────────────────│  │
│  │                                                   │  │
│  │ ヘッダーのロゴサイズを少し大きくしてほしいです。    │  │
│  │ また、フッターのリンク色を青に変更してください。    │  │
│  │                                                   │  │
│  │ 依頼者: 佐藤花子                                   │  │
│  │ 依頼日時: 2024/10/05 14:30                        │  │
│  └───────────────────────────────────────────────────┘  │
│                                                         │
│  [修正対応完了] [メッセージで確認]                      │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**表示項目**:
- **修正依頼内容**: `BookingRevisionRequest.revisionNote`（全文表示）
- **依頼者**: `Client.name`
- **依頼日時**: `BookingRevisionRequest.createdAt`

**アクション**:
- **[修正対応完了]**: 再度「完了マーク」をクリック → 修正依頼を`RESOLVED`に更新 → `AWAITING_COMPLETION`のまま（利用者の再承認待ち）
- **[メッセージで確認]**: メッセージ画面へ遷移、修正内容を確認

**複数の修正依頼がある場合**:
- 最新の修正依頼のみを表示
- 過去の修正依頼はアクティビティタイムラインで確認可能

**データ構造**:
```typescript
interface BookingRevisionRequest {
  id: string;
  bookingId: string;
  requestedBy: string;  // Client ID
  revisionNote: string;
  status: 'PENDING' | 'RESOLVED' | 'REJECTED';
  createdAt: Date;
  resolvedAt: Date | null;
}
```

#### データ構造

**申込詳細API (`GET /api/bookings/:id`)**

**レスポンス**:
```typescript
interface BookingDetailResponse {
  booking: {
    id: string;
    status: BookingStatus;
    totalPrice: number;
    feeAmount: number;
    receiveAmount: number;
    paymentIntentId: string | null;
    createdAt: Date;
    updatedAt: Date;
    completedAt: Date | null;
    service: {
      id: string;
      title: string;
      description: string;
      category: ServiceCategory;
      price: number;
      imageUrl: string | null;
    };
    client: {
      id: string;
      name: string;
      profileImage: string | null;
    };
    sponsor: {
      id: string;
      name: string;
      profileImage: string | null;
      averageRating: number | null;
    };
    review: {
      id: string;
      rating: number;
      comment: string | null;
      createdAt: Date;
    } | null;
  };
  timeline: ActivityEvent[];
  recentMessages: MessagePreview[];
  conversationId: string;
  revisionRequests: BookingRevisionRequest[];  // ★新規追加：修正依頼一覧
}

interface MessagePreview {
  id: string;
  senderId: string;
  senderName: string;
  senderType: 'CLIENT' | 'SPONSOR';
  content: string;
  createdAt: Date;
}
```

#### UIコンポーネント

**使用するshadcn/uiコンポーネント**:
- `Card`: 各セクションカード
- `Button`: アクションボタン
- `Badge`: ステータスバッジ
- `Progress`: 進行バー（カスタマイズ版）
- `Separator`: セクション区切り
- `Avatar`: ユーザーアバター
- `AlertDialog`: 確認ダイアログ
- `Textarea`: メッセージ入力
- `Toast`: 操作完了通知

#### インタラクション仕様

1. **進行バーの動的更新**:
   - ステータス変更時にアニメーション付きで更新
   - 完了ステップは緑色で強調

2. **アクションボタンの動的表示**:
   - ステータスに応じて利用可能なアクションのみ表示
   - 無効なアクションはグレーアウト

3. **タイムラインの自動更新**:
   - イベント発生時にリアルタイムで追加（Socket.io）
   - 新規イベントはフェードインアニメーション

4. **メッセージのインライン送信**:
   - 送信後、メッセージ履歴に即座に反映
   - 送信中はボタンをローディング状態に

5. **決済フロー**:
   - 「決済へ進む」クリック → Stripe決済画面へ遷移
   - 決済完了後、自動的に詳細画面に戻り、ステータス更新

#### レスポンシブ対応

**モバイル（〜768px）**:
- 進行バーを縦方向に変換
- 申込情報とアクションを縦積み
- タイムラインを簡略表示

**タブレット（768px〜1024px）**:
- 2カラムレイアウト維持
- 進行バーを横方向表示

**デスクトップ（1024px〜）**:
- 全要素を横方向表示

---

### 5.11 招待コード入力ページ

```
┌─────────────────────────────────────────────────────────────┐
│                                                               │
│                                                               │
│                          HATAMO                               │
│                                                               │
│                   招待コードを入力してください                │
│                                                               │
│                                                               │
│               ┌─────────────────────────────────┐            │
│               │  招待コード                     │            │
│               │  ┌───────────────────────────┐  │            │
│               │  │   A 3 X 9 K 2 M 7         │  │            │
│               │  └───────────────────────────┘  │            │
│               │  例: A3X9K2M7                  │            │
│               │                                 │            │
│               │  [検証中の場合]                 │            │
│               │  ⟳ 確認中...                    │            │
│               │                                 │            │
│               │  [エラーの場合]                 │            │
│               │  ⚠ 招待コードが無効です         │            │
│               │  ⚠ 有効期限が切れています       │            │
│               │  ⚠ 既に使用されています         │            │
│               │                                 │            │
│               │  [成功の場合]                   │            │
│               │  ✓ 招待コードが確認されました   │            │
│               │  登録タイプ: 利用者             │            │
│               │                                 │            │
│               │  ┌───────────────────────────┐  │            │
│               │  │        次へ               │  │            │
│               │  └───────────────────────────┘  │            │
│               │                                 │            │
│               │  招待コードをお持ちでない方は、  │            │
│               │  運営チームにお問い合わせください│            │
│               └─────────────────────────────────┘            │
│                                                               │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

**パス**: `/auth/register/invite-code`

**要素説明**:

| 要素 | 説明 |
|------|------|
| ロゴ | HATAMO ロゴ（中央配置） |
| タイトル | 「招待コードを入力してください」 |
| 招待コード入力欄 | 8文字の英数字入力フィールド（大文字変換、中央揃え、等幅フォント） |
| プレースホルダー | 「例: A3X9K2M7」 |
| エラーメッセージ | バリデーションエラー表示エリア（赤色） |
| 成功メッセージ | 検証成功メッセージ表示エリア（青色） |
| ユーザータイプ表示 | CLIENT（利用者）/ SPONSOR（スポンサー）の判定結果 |
| 次へボタン | 検証後、登録ページへ遷移 |
| 補足テキスト | 招待コード未保有者への案内 |

**インタラクション**:

1. **入力時**:
   - 自動的に大文字変換
   - 8文字を超える入力を制限
   - エラーメッセージをクリア

2. **検証ボタンクリック時**:
   - フロントエンドバリデーション（8文字英数字チェック）
   - API呼び出しで招待コード検証
   - ローディング状態表示（ボタン無効化、スピナー表示）

3. **検証成功時**:
   - 成功メッセージ表示
   - ユーザータイプ表示（CLIENT / SPONSOR）
   - 1秒後に該当登録ページへ自動リダイレクト
     - CLIENT → `/auth/register/client?code={招待コード}`
     - SPONSOR → `/auth/register/sponsor?code={招待コード}`

4. **検証失敗時**:
   - エラーメッセージ表示
   - 入力フィールドを赤枠表示
   - ボタンを再度有効化

**API連携**:

```typescript
// リクエスト
POST /api/auth/verify-invite-code
Content-Type: application/json

{
  "code": "A3X9K2M7"
}

// レスポンス（成功）
200 OK
{
  "success": true,
  "userType": "CLIENT", // or "SPONSOR"
  "message": "招待コードが確認されました"
}

// レスポンス（エラー）
400 Bad Request
{
  "success": false,
  "message": "招待コードが無効です" // or "有効期限が切れています" or "既に使用されています"
}
```

**バリデーションルール**:

| ルール | 説明 |
|--------|------|
| 必須 | 招待コードは必須入力 |
| フォーマット | 英数字8文字（A-Z, 0-9） |
| 大文字変換 | 入力は自動的に大文字に変換 |
| 存在確認 | データベースに存在すること |
| ステータス | ACTIVE であること（USED, EXPIRED, DISABLED は不可） |
| 有効期限 | 有効期限内であること（NULL の場合は無期限） |

**エラーメッセージ**:

| エラー | メッセージ |
|--------|-----------|
| 未入力 | 「招待コードを入力してください」 |
| フォーマット不正 | 「招待コードは8文字の英数字で入力してください」 |
| コード不存在 | 「招待コードが無効です」 |
| 既に使用済み | 「この招待コードは既に使用されています」 |
| 有効期限切れ | 「招待コードの有効期限が切れています」 |
| 無効化済み | 「招待コードが無効です」 |
| API接続エラー | 「招待コードの検証に失敗しました」 |

**レスポンシブ対応**:

**モバイル（〜768px）**:
- カードの横幅を画面幅の90%に調整
- パディングを縮小（16px → 12px）
- フォントサイズを調整（タイトル: 24px → 20px）

**タブレット（768px〜1024px）**:
- カードの最大幅を500pxに設定
- 中央配置を維持

**デスクトップ（1024px〜）**:
- カードの最大幅を512pxに設定
- 十分な余白を確保

**アクセシビリティ**:

- `aria-invalid` 属性でエラー状態を示す
- エラーメッセージに `role="alert"` を付与
- キーボード操作対応（Enter キーで検証実行）
- フォーカス状態の視覚的フィードバック
- スクリーンリーダー対応のラベル

**実装ファイル**:

- `/frontend/src/app/auth/register/invite-code/page.tsx` - 招待コード入力ページ
- `/frontend/src/app/auth/register/client/page.tsx` - CLIENT登録ページ（プレースホルダー）
- `/frontend/src/app/auth/register/sponsor/page.tsx` - SPONSOR登録ページ（プレースホルダー）

**技術仕様**:

- Next.js 15 App Router
- shadcn/ui コンポーネント（Card, Input, Button, Label）
- Tailwind CSS
- React Hook Form（将来的に導入予定）
- Zod（バリデーションスキーマ）（将来的に導入予定）

### 5.12 サービス申込ページ

```
┌─────────────────────────────────────────────────────────────┐
│ HATAMO Logo              Search Box               [Profile] │
├─────────────────────────────────────────────────────────────┤
│ Home > サービス一覧 > Webサイト制作 > 申込                  │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  サービス申込                                                 │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━            │
│                                                               │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ Step 1: 申込情報  →  Step 2: 決済  →  Step 3: 完了  │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                               │
│  ┌───────────────────────────────┬─────────────────────────┐│
│  │ 申込フォーム                  │ サービス情報サマリー    ││
│  ├───────────────────────────────┤ ┌─────────────────────┐ ││
│  │                               │ │ [サービス画像]      │ ││
│  │ 申込者情報                    │ │ 320x180             │ ││
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━ │ └─────────────────────┘ ││
│  │                               │                         ││
│  │ 氏名 *                        │ Webサイト制作           ││
│  │ ┌───────────────────────────┐│ ★★★★★ 4.8 (24件)    ││
│  │ │ 田中太郎                  ││                         ││
│  │ └───────────────────────────┘│ 提供者: 佐藤花子        ││
│  │                               │ [Avatar] ★★★★☆ 4.5    ││
│  │ メールアドレス *              │                         ││
│  │ ┌───────────────────────────┐│ ─────────────────────   ││
│  │ │ tanaka@example.com        ││ 料金詳細                ││
│  │ └───────────────────────────┘│ ━━━━━━━━━━━━━━━━━━━   ││
│  │                               │                         ││
│  │ 電話番号                      │ サービス基本料金        ││
│  │ ┌───────────────────────────┐│ ¥50,000                 ││
│  │ │ 090-1234-5678             ││                         ││
│  │ └───────────────────────────┘│ 手数料 (30% + 運営5%)   ││
│  │                               │ ¥17,500                 ││
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━ │                         ││
│  │                               │ ─────────────────────   ││
│  │ サービス詳細                  │ 合計支払額              ││
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━ │ ¥67,500                 ││
│  │                               │ ─────────────────────   ││
│  │ 希望納期 *                    │                         ││
│  │ ┌───────────────────────────┐│ ┌─────────────────────┐ ││
│  │ │ 2025/11/01          [▼]  ││ │ [決済へ進む]        │ ││
│  │ └───────────────────────────┘│ └─────────────────────┘ ││
│  │                               │                         ││
│  │ 要望・質問事項                │                         ││
│  │ ┌───────────────────────────┐│                         ││
│  │ │                           ││                         ││
│  │ │ Webサイトのリニューアルを ││                         ││
│  │ │ 検討しています...         ││                         ││
│  │ │                           ││                         ││
│  │ │                           ││                         ││
│  │ │ (500文字まで)             ││                         ││
│  │ └───────────────────────────┘│                         ││
│  │ 残り450文字                   │                         ││
│  │                               │                         ││
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━ │                         ││
│  │                               │                         ││
│  │ 同意事項                      │                         ││
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━ │                         ││
│  │                               │                         ││
│  │ □ [利用規約]に同意する *      │                         ││
│  │ □ [プライバシーポリシー]に    │                         ││
│  │   同意する *                  │                         ││
│  │ □ [特定商取引法表記]を        │                         ││
│  │   確認しました *              │                         ││
│  │ □ [キャンセルポリシー]に      │                         ││
│  │   同意する *                  │                         ││
│  │                               │                         ││
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━ │                         ││
│  │                               │                         ││
│  │ [reCAPTCHA]                   │                         ││
│  │ ┌───────────────────────────┐│                         ││
│  │ │ ☑ 私はロボットではありません││                         ││
│  │ └───────────────────────────┘│                         ││
│  │                               │                         ││
│  │ ─────────────────────────────│                         ││
│  │                               │                         ││
│  │ [キャンセル]  [申し込む]      │                         ││
│  │                               │                         ││
│  └───────────────────────────────┴─────────────────────────┘│
│                                                               │
├─────────────────────────────────────────────────────────────┤
│ Footer: About | Terms | Privacy | Contact                    │
└─────────────────────────────────────────────────────────────┘
```

**パス**: `/client/services/:serviceId/booking`

**要素説明**:

| 要素 | 説明 |
|------|------|
| パンくずリスト | Home > サービス一覧 > サービス詳細 > 申込 |
| ページタイトル | 「サービス申込」 |
| 進捗インジケーター | Step 1: 申込情報 → Step 2: 決済 → Step 3: 完了（現在Step 1） |
| 申込フォーム | 左カラム: 申込者情報、サービス詳細、同意事項入力エリア |
| サービス情報サマリー | 右カラム: サービス概要、料金詳細、決済ボタン（固定表示） |
| サービス画像 | サムネイル表示（320x180px） |
| サービスタイトル | サービス名と評価 |
| 提供者情報 | アバター、名前、評価 |
| 料金詳細 | 基本料金、手数料、合計金額 |
| 申込者情報セクション | 氏名、メールアドレス、電話番号（必須/任意） |
| サービス詳細セクション | 希望納期、要望・質問事項 |
| 同意事項セクション | 利用規約、プライバシーポリシー、特定商取引法、キャンセルポリシー |
| reCAPTCHA | Google reCAPTCHA v2チェックボックス |
| アクションボタン | キャンセル、申し込むボタン |

**データ構造**:

```typescript
interface BookingFormData {
  // 申込者情報
  fullName: string;           // 氏名（必須）
  email: string;              // メールアドレス（必須）
  phone: string | null;       // 電話番号（任意）

  // サービス詳細
  serviceId: string;          // サービスID
  desiredDeliveryDate: Date;  // 希望納期（必須）
  requestDetails: string;     // 要望・質問事項（最大500文字）

  // 同意事項
  agreeToTerms: boolean;      // 利用規約同意（必須）
  agreeToPrivacy: boolean;    // プライバシーポリシー同意（必須）
  agreeToCommercialLaw: boolean; // 特定商取引法確認（必須）
  agreeToCancellation: boolean;  // キャンセルポリシー同意（必須）

  // reCAPTCHA
  recaptchaToken: string;     // reCAPTCHAトークン（必須）
}

interface ServiceSummary {
  id: string;
  title: string;
  thumbnailUrl: string;
  rating: number;
  reviewCount: number;
  basePrice: number;          // 基本料金
  feeRate: number;            // 手数料率（0.30 = 30%）
  platformFeeRate: number;    // 運営手数料率（0.05 = 5%）
  totalFee: number;           // 手数料合計
  totalPrice: number;         // 合計支払額
  sponsor: {
    id: string;
    name: string;
    avatarUrl: string;
    rating: number;
  };
}
```

**バリデーションルール**:

| フィールド | ルール |
|-----------|--------|
| 氏名 | 必須、1文字以上50文字以下、全角・半角対応 |
| メールアドレス | 必須、有効なメール形式、最大100文字 |
| 電話番号 | 任意、数字とハイフンのみ、10〜11桁 |
| 希望納期 | 必須、今日以降の日付、サービス提供可能期間内 |
| 要望・質問事項 | 任意、最大500文字、改行含む |
| 利用規約同意 | 必須、チェック必須 |
| プライバシーポリシー同意 | 必須、チェック必須 |
| 特定商取引法確認 | 必須、チェック必須 |
| キャンセルポリシー同意 | 必須、チェック必須 |
| reCAPTCHA | 必須、トークン検証 |

**料金計算ロジック**:

```typescript
// 手数料計算
const serviceFee = basePrice * feeRate;           // サービス手数料 = 50,000 × 0.30 = 15,000
const platformFee = basePrice * platformFeeRate;  // 運営手数料 = 50,000 × 0.05 = 2,500
const totalFee = serviceFee + platformFee;        // 合計手数料 = 17,500

// 利用者支払額（基本料金 + 手数料）
const totalPrice = basePrice + totalFee;          // 67,500

// スポンサー受取額（基本料金 - サービス手数料）
const sponsorRevenue = basePrice - serviceFee;    // 35,000
```

**API仕様**:

**サービス情報取得API**:

```typescript
GET /api/client/services/:serviceId/booking-info

// レスポンス（成功）
200 OK
{
  "service": {
    "id": "srv_123456",
    "title": "Webサイト制作",
    "thumbnailUrl": "https://cdn.hatamo.jp/services/srv_123456.jpg",
    "rating": 4.8,
    "reviewCount": 24,
    "basePrice": 50000,
    "feeRate": 0.30,
    "platformFeeRate": 0.05,
    "totalFee": 17500,
    "totalPrice": 67500,
    "availableDeliveryDates": {
      "minDate": "2025-11-01",
      "maxDate": "2026-01-31"
    }
  },
  "sponsor": {
    "id": "usr_789012",
    "name": "佐藤花子",
    "avatarUrl": "https://cdn.hatamo.jp/avatars/usr_789012.jpg",
    "rating": 4.5
  }
}

// レスポンス（エラー）
404 Not Found
{
  "error": "SERVICE_NOT_FOUND",
  "message": "サービスが見つかりません"
}

400 Bad Request
{
  "error": "SERVICE_NOT_AVAILABLE",
  "message": "このサービスは現在申込を受け付けていません"
}
```

**申込作成API**:

```typescript
POST /api/client/bookings
Content-Type: application/json
Authorization: Bearer {access_token}

{
  "serviceId": "srv_123456",
  "fullName": "田中太郎",
  "email": "tanaka@example.com",
  "phone": "090-1234-5678",
  "desiredDeliveryDate": "2025-11-01",
  "requestDetails": "Webサイトのリニューアルを検討しています...",
  "agreeToTerms": true,
  "agreeToPrivacy": true,
  "agreeToCommercialLaw": true,
  "agreeToCancellation": true,
  "recaptchaToken": "03AGdBq27..."
}

// レスポンス（成功）
201 Created
{
  "booking": {
    "id": "bkg_345678",
    "serviceId": "srv_123456",
    "status": "PENDING_PAYMENT",
    "totalPrice": 67500,
    "createdAt": "2025-10-07T10:30:00Z"
  },
  "paymentUrl": "https://checkout.stripe.com/c/pay/cs_test_...",
  "message": "申込が作成されました。決済を完了してください。"
}

// レスポンス（エラー）
400 Bad Request
{
  "error": "VALIDATION_ERROR",
  "message": "入力内容に誤りがあります",
  "errors": [
    {
      "field": "email",
      "message": "有効なメールアドレスを入力してください"
    },
    {
      "field": "agreeToTerms",
      "message": "利用規約への同意が必要です"
    }
  ]
}

401 Unauthorized
{
  "error": "AUTHENTICATION_REQUIRED",
  "message": "ログインが必要です"
}

403 Forbidden
{
  "error": "RECAPTCHA_VERIFICATION_FAILED",
  "message": "reCAPTCHA認証に失敗しました"
}

409 Conflict
{
  "error": "DUPLICATE_BOOKING",
  "message": "このサービスは既に申込済みです"
}
```

**インタラクション仕様**:

1. **ページ初期表示**:
   - URLパラメータから`serviceId`を取得
   - サービス情報取得APIを呼び出し
   - サービス情報サマリーを表示
   - ログインユーザーの場合、メールアドレスを自動入力

2. **入力時バリデーション**:
   - 氏名: リアルタイムで文字数チェック
   - メールアドレス: フォーカスアウト時にフォーマット検証
   - 電話番号: 入力時に自動フォーマット（ハイフン挿入）
   - 要望・質問事項: 残り文字数をリアルタイム表示

3. **希望納期選択**:
   - DatePickerで選択
   - サービス提供可能期間内の日付のみ選択可能
   - 過去の日付は選択不可

4. **同意チェック**:
   - リンクテキストをクリックで各規約を新しいタブで表示
   - 全ての同意チェックがオンになるまで「申し込む」ボタンを無効化

5. **reCAPTCHA**:
   - Google reCAPTCHA v2チェックボックスを表示
   - トークン取得後、フォーム送信可能に

6. **申し込むボタンクリック時**:
   - フロントエンドバリデーション実行
   - エラーがあれば該当フィールドにエラーメッセージ表示
   - 検証成功で申込作成APIを呼び出し
   - ローディング状態表示（ボタン無効化、スピナー表示）

7. **申込作成成功時**:
   - Stripe決済画面へリダイレクト（`paymentUrl`）
   - 決済完了後、申込完了ページへリダイレクト

8. **申込作成失敗時**:
   - エラーメッセージをトースト通知で表示
   - フィールドエラーがあれば該当フィールドに表示
   - ボタンを再度有効化

**決済フロー詳細**:

```
1. 利用者が申込フォーム入力
   ↓
2. 「申し込む」ボタンクリック
   ↓
3. フロントエンドバリデーション
   ↓
4. 申込作成API呼び出し（POST /api/client/bookings）
   ↓
5. バックエンドで申込レコード作成（status: PENDING_PAYMENT）
   ↓
6. Stripe Checkout Sessionを作成
   ↓
7. Checkout Session URLを返す
   ↓
8. Stripe決済画面へリダイレクト
   ↓
9. 利用者がクレジットカード情報を入力
   ↓
10. 決済完了
   ↓
11. Stripe Webhookで決済完了通知受信
   ↓
12. 申込ステータスを AWAITING_APPROVAL に更新
   ↓
13. スポンサーに申込通知メール送信
   ↓
14. 申込完了ページへリダイレクト（success_url）
   ↓
15. スポンサーが申込を承認
   ↓
16. 申込ステータスを IN_PROGRESS に更新
   ↓
17. サービス提供開始
```

**Stripe連携仕様**:

```typescript
// Stripe Checkout Session作成
const session = await stripe.checkout.sessions.create({
  payment_method_types: ['card'],
  line_items: [
    {
      price_data: {
        currency: 'jpy',
        product_data: {
          name: service.title,
          images: [service.thumbnailUrl],
        },
        unit_amount: totalPrice, // 67500円
      },
      quantity: 1,
    },
  ],
  mode: 'payment',
  success_url: `${FRONTEND_URL}/client/bookings/${booking.id}/complete?session_id={CHECKOUT_SESSION_ID}`,
  cancel_url: `${FRONTEND_URL}/client/services/${serviceId}/booking?canceled=true`,
  metadata: {
    bookingId: booking.id,
    serviceId: service.id,
    sponsorId: sponsor.id,
  },
});
```

**エラーハンドリング**:

| エラー種別 | ハンドリング |
|-----------|-------------|
| バリデーションエラー | フィールド単位でエラーメッセージ表示 |
| 認証エラー | ログインページへリダイレクト |
| reCAPTCHA検証失敗 | トースト通知 + reCAPTCHAリセット |
| サービス取得失敗 | エラーページ表示（404 Not Found） |
| 申込作成失敗 | トースト通知 + フォーム再編集可能 |
| 決済キャンセル | 申込ページに戻る（URLパラメータ `?canceled=true`） |
| ネットワークエラー | リトライ可能なエラートースト表示 |

**レスポンシブ対応**:

**モバイル（〜768px）**:
- 1カラムレイアウトに変更
- サービス情報サマリーを上部に配置
- 申込フォームを下部に配置
- 料金詳細をアコーディオンで折りたたみ可能に
- フォントサイズ調整（16px → 14px）

**タブレット（768px〜1024px）**:
- 2カラムレイアウト維持
- カラム幅比率を6:4から7:3に調整
- 余白を適度に確保

**デスクトップ（1024px〜）**:
- 2カラムレイアウト（左60% : 右40%）
- 最大幅1280pxに制限
- サービス情報サマリーを固定表示（sticky position）
- 十分な余白を確保

**実装ファイル**:

- `/frontend/src/app/client/services/[serviceId]/booking/page.tsx` - 申込ページメインコンポーネント
- `/frontend/src/components/booking/BookingForm.tsx` - 申込フォームコンポーネント
- `/frontend/src/components/booking/ServiceSummary.tsx` - サービス情報サマリーコンポーネント
- `/frontend/src/components/booking/PriceBreakdown.tsx` - 料金詳細コンポーネント
- `/frontend/src/hooks/useBookingForm.ts` - 申込フォームロジック（React Hook）
- `/frontend/src/lib/validations/booking.ts` - バリデーションスキーマ（Zod）
- `/frontend/src/lib/api/bookings.ts` - 申込API呼び出し関数

**技術仕様**:

- Next.js 15 App Router
- React Hook Form + Zod（バリデーション）
- shadcn/ui コンポーネント（Card, Input, Button, Label, Textarea, Checkbox, Calendar）
- Tailwind CSS
- Stripe Checkout
- Google reCAPTCHA v2

**セキュリティ**:

- reCAPTCHA v2チェックボックス必須
- CSRFトークン検証
- レート制限（1ユーザーあたり1分間に3回まで）
- XSS対策（入力値のエスケープ）
- SQLインジェクション対策（Prisma ORMによるパラメータバインド）

---

## 6. レスポンシブ設計

### 6.1 ブレークポイント

```
sm:  640px  (スマートフォン横向き)
md:  768px  (タブレット縦向き)
lg:  1024px (タブレット横向き、小型ラップトップ)
xl:  1280px (デスクトップ)
2xl: 1536px (大型デスクトップ)
```

### 6.2 デバイス別レイアウト戦略

#### モバイル（〜639px）

- **ナビゲーション**: ハンバーガーメニュー（Sheet）
- **グリッド**: 1列表示
- **フォント**: base（16px）
- **スペーシング**: 小さめ（p-4）
- **カード**: フル幅
- **テーブル**: カード形式に変換
- **サイドバー**: 非表示（Sheet で開閉）

#### タブレット（640px〜1023px）

- **ナビゲーション**: タブナビゲーション
- **グリッド**: 2列表示
- **フォント**: base〜lg
- **スペーシング**: 中程度（p-6）
- **カード**: 2列グリッド
- **サイドバー**: 折りたたみ可能

#### デスクトップ（1024px〜）

- **ナビゲーション**: 横並びナビゲーション
- **グリッド**: 3〜4列表示
- **フォント**: base〜xl
- **スペーシング**: 大きめ（p-8）
- **カード**: 3〜4列グリッド
- **サイドバー**: 常時表示

### 6.3 コンテナ幅

```
Max Width (max-w-*)
- sm:   640px  (狭いコンテンツ)
- md:   768px  (フォーム)
- lg:   1024px (記事)
- xl:   1280px (一般コンテンツ)
- 2xl:  1536px (ダッシュボード)
- 7xl:  80rem (1280px) - メインコンテナ
- full: 100%   (フル幅)
```

---

## 7. 実装ガイドライン

### 7.1 技術スタック

- **Framework**: Next.js 15 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS v4
- **UI Components**: shadcn/ui
- **State Management**: Zustand
- **Form**: React Hook Form + Zod
- **API Communication**: Fetch API / Axios
- **Real-time**: Socket.io Client

### 7.2 ディレクトリ構造（推奨）

```
frontend/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── (auth)/             # 認証グループ
│   │   │   ├── login/
│   │   │   └── register/
│   │   ├── (client)/           # 利用者グループ
│   │   │   ├── dashboard/
│   │   │   ├── services/
│   │   │   ├── messages/
│   │   │   └── bookings/
│   │   ├── (sponsor)/          # スポンサーグループ
│   │   │   ├── dashboard/
│   │   │   ├── services/
│   │   │   └── bookings/
│   │   ├── layout.tsx          # ルートレイアウト
│   │   └── page.tsx            # トップページ
│   ├── components/             # 共通コンポーネント
│   │   ├── ui/                 # shadcn/ui コンポーネント
│   │   ├── layout/             # レイアウトコンポーネント
│   │   │   ├── Header.tsx
│   │   │   ├── Footer.tsx
│   │   │   ├── Sidebar.tsx
│   │   │   └── Navigation.tsx
│   │   ├── service/            # サービス関連
│   │   │   ├── ServiceCard.tsx
│   │   │   ├── ServiceList.tsx
│   │   │   └── ServiceFilter.tsx
│   │   ├── message/            # メッセージ関連
│   │   │   ├── MessageList.tsx
│   │   │   ├── ChatWindow.tsx
│   │   │   └── MessageInput.tsx
│   │   └── common/             # 汎用コンポーネント
│   │       ├── Avatar.tsx
│   │       ├── Badge.tsx
│   │       └── EmptyState.tsx
│   ├── lib/                    # ユーティリティ
│   │   ├── api.ts              # APIクライアント
│   │   ├── utils.ts            # 汎用関数
│   │   └── validations.ts      # Zodスキーマ
│   ├── hooks/                  # カスタムフック
│   │   ├── useAuth.ts
│   │   ├── useSocket.ts
│   │   └── useServices.ts
│   ├── stores/                 # Zustand ストア
│   │   ├── authStore.ts
│   │   ├── messageStore.ts
│   │   └── bookingStore.ts
│   ├── types/                  # TypeScript型定義
│   │   ├── user.ts
│   │   ├── service.ts
│   │   ├── booking.ts
│   │   └── message.ts
│   └── styles/                 # グローバルスタイル
│       └── globals.css
├── public/                     # 静的ファイル
│   ├── images/
│   └── icons/
└── package.json
```

### 7.3 コーディング規約

#### コンポーネント命名

```tsx
// ファイル名: PascalCase
// ServiceCard.tsx

// コンポーネント名: PascalCase
export const ServiceCard: React.FC<ServiceCardProps> = ({ service }) => {
  // ...
}
```

#### Props定義

```tsx
// インターフェース定義
interface ServiceCardProps {
  service: Service;
  onClick?: (id: string) => void;
  className?: string;
}

// デフォルトProps
const ServiceCard: React.FC<ServiceCardProps> = ({
  service,
  onClick,
  className = ""
}) => {
  // ...
}
```

#### Tailwind CSS クラス整理

```tsx
// cn() ユーティリティを使用
import { cn } from "@/lib/utils";

<div className={cn(
  "rounded-lg border bg-card p-6 shadow-sm",
  "hover:shadow-md transition-shadow",
  className
)}>
  {/* ... */}
</div>
```

#### ステート管理（Zustand）

```tsx
// stores/authStore.ts
import { create } from 'zustand';

interface AuthState {
  user: User | null;
  isAuthenticated: boolean;
  login: (user: User) => void;
  logout: () => void;
}

export const useAuthStore = create<AuthState>((set) => ({
  user: null,
  isAuthenticated: false,
  login: (user) => set({ user, isAuthenticated: true }),
  logout: () => set({ user: null, isAuthenticated: false }),
}));
```

#### フォームバリデーション（Zod）

```tsx
import { z } from "zod";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";

const loginSchema = z.object({
  email: z.string().email("有効なメールアドレスを入力してください"),
  password: z.string().min(8, "パスワードは8文字以上である必要があります"),
});

type LoginFormData = z.infer<typeof loginSchema>;

const LoginForm = () => {
  const form = useForm<LoginFormData>({
    resolver: zodResolver(loginSchema),
  });

  // ...
}
```

### 7.4 アクセシビリティ

#### キーボード操作

- Tab: フォーカス移動
- Enter/Space: ボタン・リンク実行
- Esc: モーダル・ドロップダウン閉じる
- Arrow keys: リスト・メニュー内移動

#### セマンティックHTML

```tsx
// Good
<button onClick={handleClick}>送信</button>
<nav>...</nav>
<main>...</main>

// Bad
<div onClick={handleClick}>送信</div>
```

#### ARIAラベル

```tsx
<button aria-label="メニューを開く">
  <MenuIcon />
</button>

<input
  type="search"
  aria-label="サービスを検索"
  placeholder="キーワード..."
/>
```

### 7.5 パフォーマンス最適化

#### 画像最適化

```tsx
import Image from 'next/image';

<Image
  src="/images/service.jpg"
  alt="サービス画像"
  width={400}
  height={300}
  loading="lazy"
  placeholder="blur"
/>
```

#### 動的インポート

```tsx
import dynamic from 'next/dynamic';

const ChatWindow = dynamic(() => import('@/components/message/ChatWindow'), {
  loading: () => <Skeleton />,
  ssr: false,
});
```

#### メモ化

```tsx
import { useMemo, useCallback } from 'react';

const ServiceList = ({ services }) => {
  const filteredServices = useMemo(() => {
    return services.filter(/* ... */);
  }, [services]);

  const handleClick = useCallback((id: string) => {
    // ...
  }, []);

  return <div>{/* ... */}</div>;
}
```

---

## 付録

### A. カラーコード一覧（Tailwind CSS変数）

```css
/* globals.css */
@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --primary: 221.2 83.2% 53.3%; /* Blue-600 */
    --primary-foreground: 210 40% 98%;
    --secondary: 24.6 95% 53.1%; /* Orange-500 */
    --secondary-foreground: 0 0% 98%;
    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;
    --accent: 210 40% 96.1%;
    --accent-foreground: 222.2 47.4% 11.2%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 221.2 83.2% 53.3%;
    --radius: 0.5rem;
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    /* ... */
  }
}
```

### B. アニメーション定義

```css
/* globals.css */
@layer utilities {
  @keyframes slide-in-right {
    from {
      transform: translateX(100%);
    }
    to {
      transform: translateX(0);
    }
  }

  @keyframes fade-in {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  .animate-slide-in-right {
    animation: slide-in-right 0.3s ease-out;
  }

  .animate-fade-in {
    animation: fade-in 0.2s ease-in;
  }
}
```

### C. 主要コンポーネント使用例

#### Button

```tsx
import { Button } from "@/components/ui/button";

<Button variant="default">送信</Button>
<Button variant="secondary">キャンセル</Button>
<Button variant="outline">詳細</Button>
<Button variant="ghost">閉じる</Button>
<Button variant="destructive">削除</Button>
```

#### Card

```tsx
import { Card, CardHeader, CardTitle, CardDescription, CardContent, CardFooter } from "@/components/ui/card";

<Card>
  <CardHeader>
    <CardTitle>カードタイトル</CardTitle>
    <CardDescription>説明文</CardDescription>
  </CardHeader>
  <CardContent>
    <p>コンテンツ</p>
  </CardContent>
  <CardFooter>
    <Button>アクション</Button>
  </CardFooter>
</Card>
```

#### Dialog

```tsx
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from "@/components/ui/dialog";

<Dialog open={isOpen} onOpenChange={setIsOpen}>
  <DialogContent>
    <DialogHeader>
      <DialogTitle>ダイアログタイトル</DialogTitle>
      <DialogDescription>説明文</DialogDescription>
    </DialogHeader>
    <div>コンテンツ</div>
    <DialogFooter>
      <Button onClick={() => setIsOpen(false)}>キャンセル</Button>
      <Button onClick={handleConfirm}>確定</Button>
    </DialogFooter>
  </DialogContent>
</Dialog>
```

---

## 8. データベーススキーマ更新

### 8.1 Bookingテーブル更新

#### 新規カラム追加

```prisma
model Booking {
  id String @id @default(uuid())
  serviceId String @map("service_id")
  clientId String @map("client_id")
  sponsorId String @map("sponsor_id")

  status BookingStatus @default(PENDING)
  totalPrice Int @map("total_price")
  feeAmount Int @map("fee_amount")
  feeRate Int @map("fee_rate") // 手数料率（20/30/40/50）

  // 日時カラム
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  acceptedAt DateTime? @map("accepted_at")     // スポンサーが承認した日時
  paidAt DateTime? @map("paid_at")             // 決済完了日時
  startedAt DateTime? @map("started_at")       // 作業開始日時
  completedAt DateTime? @map("completed_at")   // スポンサーが完了報告した日時
  approvedAt DateTime? @map("approved_at")     // ★新規追加：利用者が完了承認した日時
  cancelledAt DateTime? @map("cancelled_at")   // キャンセル日時

  // Stripe決済情報
  stripePaymentIntentId String? @map("stripe_payment_intent_id")
  stripeRefundId String? @map("stripe_refund_id")

  // 申込情報
  requestNote String? @db.Text @map("request_note") // 利用者からの要望
  cancelReason String? @db.Text @map("cancel_reason") // キャンセル理由

  // Relations
  service Service @relation(fields: [serviceId], references: [id])
  client User @relation("ClientBookings", fields: [clientId], references: [id])
  sponsor User @relation("SponsorBookings", fields: [sponsorId], references: [id])
  messages Message[]
  review Review?
  revisionRequests BookingRevisionRequest[] // ★新規追加

  @@map("bookings")
  @@index([clientId])
  @@index([sponsorId])
  @@index([status])
  @@index([createdAt])
}
```

#### BookingStatus Enum 更新

```prisma
enum BookingStatus {
  PENDING              // 承認待ち
  REJECTED             // 拒否
  ACCEPTED             // 承認済み（決済待ち）
  PAID                 // 決済完了
  IN_PROGRESS          // 作業中
  AWAITING_COMPLETION  // ★新規追加：完了確認待ち
  COMPLETED            // 完了
  CANCELLED            // キャンセル（決済前）
  REFUNDED             // 返金済み（決済後キャンセル）
}
```

### 8.2 BookingRevisionRequest テーブル新規作成

#### テーブル定義

```prisma
model BookingRevisionRequest {
  id String @id @default(uuid())
  bookingId String @map("booking_id")
  requestedBy String @map("requested_by") // 利用者ID
  revisionNote String @db.Text @map("revision_note") // 修正内容
  status RevisionStatus @default(PENDING)
  createdAt DateTime @default(now()) @map("created_at")
  resolvedAt DateTime? @map("resolved_at")
  resolvedBy String? @map("resolved_by") // スポンサーID
  responseNote String? @db.Text @map("response_note") // スポンサーからの返信

  // Relations
  booking Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  client User @relation("ClientRevisionRequests", fields: [requestedBy], references: [id])
  sponsor User? @relation("SponsorRevisionRequests", fields: [resolvedBy], references: [id])

  @@map("booking_revision_requests")
  @@index([bookingId])
  @@index([requestedBy])
  @@index([status])
  @@index([createdAt])
}
```

#### RevisionStatus Enum 新規作成

```prisma
enum RevisionStatus {
  PENDING   // 修正依頼中
  RESOLVED  // 修正完了
  REJECTED  // 修正拒否（例外的なケース）
}
```

### 8.3 User テーブルへのリレーション追加

```prisma
model User {
  id String @id @default(uuid())
  email String @unique
  passwordHash String @map("password_hash")
  userType UserType @map("user_type")
  name String
  profileImage String? @map("profile_image")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  usedInviteCode InviteCode? @relation("InviteCodeUser")
  services Service[]
  clientBookings Booking[] @relation("ClientBookings")
  sponsorBookings Booking[] @relation("SponsorBookings")
  sentMessages Message[] @relation("SentMessages")
  clientConversations Conversation[] @relation("ClientConversations")
  sponsorConversations Conversation[] @relation("SponsorConversations")

  // ★新規追加：修正依頼関連
  clientRevisionRequests BookingRevisionRequest[] @relation("ClientRevisionRequests")
  sponsorRevisionRequests BookingRevisionRequest[] @relation("SponsorRevisionRequests")

  @@map("users")
}
```

### 8.4 マイグレーションコマンド

```bash
# Prismaスキーマ更新後、以下のコマンドを実行

# マイグレーションファイル生成
npx prisma migrate dev --name add_awaiting_completion_and_revision_requests

# Prisma Clientを再生成
npx prisma generate

# データベース接続確認
npx prisma db push

# Prisma Studioで確認
npx prisma studio
```

### 8.5 既存データのマイグレーション注意点

**AWAITING_COMPLETION ステータス追加による影響**:

既存のBookingレコードで `status = 'IN_PROGRESS'` かつ `completedAt` が設定されているレコードは、`AWAITING_COMPLETION` に変更する必要がある可能性があります。

```sql
-- 既存データの修正例（必要に応じて実行）
UPDATE bookings
SET status = 'AWAITING_COMPLETION'
WHERE status = 'IN_PROGRESS'
  AND completed_at IS NOT NULL
  AND approved_at IS NULL;
```

---

## 変更履歴

| バージョン | 日付 | 変更内容 | 担当者 |
|-----------|------|---------|--------|
| v1.0 | 2025/10/02 | 初版作成 | 設計チーム |
| v1.1 | 2025/10/02 | ユーザーフロー修正: 新規ユーザーと既存ユーザーのフロー分離、アクセス制御の明確化 | 設計チーム |
| v1.2 | 2025/10/02 | ワイヤーフレーム追加: 利用者ダッシュボード（5.2）を追加 | 設計チーム |
| v1.3 | 2025/10/05 | ワイヤーフレーム追加: スポンサー向けサービス一覧（マイサービス）（5.7）を追加。検索・フィルター機能、統計カード、データ構造、API仕様、インタラクション仕様、レスポンシブ対応を詳細化 | 設計チーム |
| v1.4 | 2025/10/05 | ワイヤーフレーム追加: 利用者向けマイ申込一覧（5.8）、スポンサー向け申込管理（5.9）、申込詳細画面（5.10）を追加。BookingStatus（7段階）に対応したステータス管理、進行バー、タイムライン、アクションボタン、手数料計算ロジック、API仕様、データ構造、インタラクション仕様、レスポンシブ対応を詳細化 | 設計チーム |
| v1.5 | 2025/10/06 | **重要更新**: AWAITING_COMPLETION（完了確認待ち）ステータスを追加。利用者による完了承認フローを実装。修正依頼機能（BookingRevisionRequestテーブル）を追加。スポンサー申込管理画面（5.9）にステータス遷移フロー詳細を追加。データベーススキーマセクション（8章）を新規追加。売上確定タイミングを「利用者の承認後」に変更。 | 設計チーム |
| v1.6 | 2025/10/06 | **申込詳細画面（5.10）を更新**: ステータス進行バーを6ステップに拡張（確認待ちステップを追加）。スポンサー視点・利用者視点のアクションにAWAITING_COMPLETION対応を追加。修正依頼エリアを新規追加（ワイヤーフレーム、データ構造、アクション仕様）。アクティビティタイムラインに完了報告・修正依頼・完了承認イベントを追加。APIレスポンスにrevisionRequests配列を追加。 | 設計チーム |
| v1.7 | 2025/10/06 | **招待コード入力ページ（5.11）を新規追加**: 認証フロー第一段階の招待コード検証画面を実装。8文字英数字バリデーション、ユーザータイプ自動判定、エラーハンドリング、API仕様、レスポンシブ対応、アクセシビリティ対応を詳細化。実装ファイル3点を作成（invite-code/page.tsx, client/page.tsx, sponsor/page.tsx）。 | 設計チーム |
| v1.8 | 2025/10/07 | **サービス申込ページ（5.12）を新規追加**: 利用者・スポンサー共通のサービス申込ページを実装。2カラムレイアウト（申込フォーム + サービス情報サマリー）、進捗インジケーター、申込者情報入力、希望納期選択、要望・質問事項（500文字制限）、同意チェック（利用規約・プライバシーポリシー・特定商取引法・キャンセルポリシー）、reCAPTCHA v2、料金計算ロジック（基本料金 + 手数料30%/40%/50% + 運営手数料5%）、Stripe決済連携、API仕様（サービス情報取得・申込作成）、決済フロー詳細（PENDING_PAYMENT → AWAITING_APPROVAL → IN_PROGRESS）、エラーハンドリング、レスポンシブ対応（モバイル1カラム・タブレット2カラム・デスクトップ固定サイドバー）、セキュリティ対策を詳細化。実装ファイル7点を定義。 | 設計チーム |

---

**作成者**: HATAMOデザインチーム
**承認者**: プロジェクトマネージャー
**最終更新**: 2025年10月7日（v1.8）
