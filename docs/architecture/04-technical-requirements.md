# HATAMOマッチングサービス - 技術要件

**作成日**: 2025年9月21日
**バージョン**: v3.0
**更新**: 技術要件の詳細化

---

## 1. プラットフォーム

- **開発形態**: Webアプリケーション
- **対象デバイス**: PC、スマートフォン（レスポンシブ対応）
- **想定規模**: 50名未満（小規模）

## 2. 認証システム

- **認証方式**: メールアドレス・パスワード認証
- **登録方式**: 招待コード必須
- **セッション管理**: ブラウザベース

### 2.1 認証・認可要件（アクセス制御）

#### ✅ 許可されるアクセス

- **未認証ユーザー**がアクセス可能なパス:
  - `/auth/*` （すべての認証関連ページ）
  - 例: `/auth/login`, `/auth/register/invite-code`, `/auth/forgot-password`

#### ❌ 制限されるアクセス

- **未認証ユーザー**が `/auth/` 以外のパスにアクセスした場合:
  - **必ず** `/auth/register/invite-code` にリダイレクト
  - 例: `/dashboard` → `/auth/register/invite-code`
  - 例: `/profile` → `/auth/register/invite-code`
  - 例: `/` (ルート) → `/auth/register/invite-code`

#### 実装方針

- **Next.js Middleware** を使用してアクセス制御を実装
- JWT トークンをクッキーまたはローカルストレージで管理
- サーバーサイドで認証状態を検証

## 3. 決済システム

- **決済サービス**: Stripe
- **対応決済**: クレジットカード決済
- **手数料体系**: サービス提供者選択制（20%/30%/40%/50% + 運営手数料5%）
- **最低価格**: 10,000円

## 4. セキュリティ

- **reCAPTCHA**: 全フォームに実装
- **同意チェック**: 購入・申込時の規約同意必須
- **アクセス制限**: 招待コード制による登録制限

## 5. 法務対応

- 利用規約（策定中）
- 特定商取引法表示
- プライバシーポリシー（策定中）
- キャンセル・返金規約（策定中）

## 6. データベース設計（Phase 1）

- **ユーザーテーブル**: 利用者・スポンサー・管理者情報
- **サービステーブル**: 提供サービス情報
- **申込テーブル**: サービス申込情報
- **決済テーブル**: 決済履歴
- **メッセージテーブル**: チャット履歴
- **レビューテーブル**: 評価・レビュー情報
- **招待コードテーブル**: 招待コード管理

## 7. 通知機能

- **メール通知**: 審査結果、申込状況
- **LINE連動**: メッセージ通知機能

---

**関連ドキュメント**:
- [プロジェクト概要](./01-project-overview.md)
- [機能要件](./02-feature-requirements.md)
- [招待コード仕様](./03-invite-code-specification.md)
- [開発計画](./05-development-plan.md)
- [セットアップ手順](./06-setup-instructions.md)
